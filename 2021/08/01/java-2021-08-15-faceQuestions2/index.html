<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>面试题2 | Hexo</title>
  <meta name="description" content="4、GitHub常用词含义watch: 会持续收到该项目的动态 fork，复制某个项目到自己的github仓库中 star,可以理解为点赞 clone，将项目下载至本地 follow，关注你感兴趣的作者，会收到他们的动态 in关键词限制搜索范围 公式 xxx关键词 in:name或description或readme xxx in:name项目名包含xxx的 xxx in:description项">
<meta property="og:type" content="article">
<meta property="og:title" content="面试题2">
<meta property="og:url" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="4、GitHub常用词含义watch: 会持续收到该项目的动态 fork，复制某个项目到自己的github仓库中 star,可以理解为点赞 clone，将项目下载至本地 follow，关注你感兴趣的作者，会收到他们的动态 in关键词限制搜索范围 公式 xxx关键词 in:name或description或readme xxx in:name项目名包含xxx的 xxx in:description项">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103758003.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103858610.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103911056.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103921742.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103937148.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105044784.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105114310.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105128914.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105156172.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816142715502.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816142833509.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816144434556.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816145506013.png">
<meta property="og:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816145535517.png">
<meta property="article:published_time" content="2021-08-01T12:56:06.000Z">
<meta property="article:modified_time" content="2021-08-19T02:34:03.632Z">
<meta property="article:author" content="stary">
<meta property="article:tag" content="java">
<meta property="article:tag" content="面试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103758003.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://stary1999.github.io" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">stary</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">愿启明星照亮信仰，照进现实</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Jiangsu, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/stary" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p> </br> <p>博客迁移，功能尚未完善，评论无效</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/2021%E8%AF%BE%E8%AE%BE/">2021课设</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/default/">default</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%AD%E8%A8%80/">语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SDN/" rel="tag">SDN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot2/" rel="tag">SpringBoot2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/default/" rel="tag">default</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idea/" rel="tag">idea</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsp/" rel="tag">jsp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">jvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springCloud/" rel="tag">springCloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A5%E9%97%A8/" rel="tag">入门</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E8%B7%B5/" rel="tag">实践</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E9%AA%8C/" rel="tag">实验</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%83%E5%BE%97/" rel="tag">心得</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">日志</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8B%82%E7%A5%9E/" rel="tag">狂神</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BE%A4%E9%9B%86/" rel="tag">群集</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E6%B3%95/" rel="tag">语法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1/" rel="tag">课程设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B8%A9%E5%9D%91/" rel="tag">踩坑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a><span class="tag-list-count">4</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Java/" style="font-size: 13px;">Java</a> <a href="/tags/Redis/" style="font-size: 13px;">Redis</a> <a href="/tags/SDN/" style="font-size: 13px;">SDN</a> <a href="/tags/SpringBoot/" style="font-size: 13px;">SpringBoot</a> <a href="/tags/SpringBoot2/" style="font-size: 13px;">SpringBoot2</a> <a href="/tags/SpringCloud/" style="font-size: 13px;">SpringCloud</a> <a href="/tags/android/" style="font-size: 13px;">android</a> <a href="/tags/default/" style="font-size: 14px;">default</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/github/" style="font-size: 13px;">github</a> <a href="/tags/hexo/" style="font-size: 13px;">hexo</a> <a href="/tags/idea/" style="font-size: 13px;">idea</a> <a href="/tags/java/" style="font-size: 13.8px;">java</a> <a href="/tags/jsp/" style="font-size: 13px;">jsp</a> <a href="/tags/jvm/" style="font-size: 13px;">jvm</a> <a href="/tags/markdown/" style="font-size: 13px;">markdown</a> <a href="/tags/springCloud/" style="font-size: 13px;">springCloud</a> <a href="/tags/ubuntu/" style="font-size: 13px;">ubuntu</a> <a href="/tags/vue/" style="font-size: 13px;">vue</a> <a href="/tags/web/" style="font-size: 13px;">web</a> <a href="/tags/%E5%85%A5%E9%97%A8/" style="font-size: 13px;">入门</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13px;">前端</a> <a href="/tags/%E5%AE%9E%E8%B7%B5/" style="font-size: 13.2px;">实践</a> <a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 13px;">实验</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 13.4px;">工具</a> <a href="/tags/%E5%BF%83%E5%BE%97/" style="font-size: 13px;">心得</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 13px;">数据库</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 13px;">日志</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 13.2px;">框架</a> <a href="/tags/%E7%8B%82%E7%A5%9E/" style="font-size: 13px;">狂神</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 13.2px;">笔记</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 13px;">网络</a> <a href="/tags/%E7%BE%A4%E9%9B%86/" style="font-size: 13px;">群集</a> <a href="/tags/%E8%AF%AD%E6%B3%95/" style="font-size: 13px;">语法</a> <a href="/tags/%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1/" style="font-size: 13px;">课程设计</a> <a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 13px;">踩坑</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 13.4px;">面试</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 13.6px;">项目</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled ">
        
          <li>
            
            <div class="item-thumb">
              <a href="/2021/08/26/EVENGOfNetwork/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
              </p>
              <p class="item-title">
                <a href="/2021/08/26/EVENGOfNetwork/" class="title">EVE-NG仿真路由组网与交换机配置</a>
              </p>
              <p class="item-date">
                <time datetime="2021-08-26T05:40:34.000Z" itemprop="datePublished">2021-08-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2021/08/26/windowsServerHyperV/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
              </p>
              <p class="item-title">
                <a href="/2021/08/26/windowsServerHyperV/" class="title">基于windows server搭建的故障群集转移</a>
              </p>
              <p class="item-date">
                <time datetime="2021-08-26T05:31:28.000Z" itemprop="datePublished">2021-08-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2021/08/26/dockerOfDeploy/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
              </p>
              <p class="item-title">
                <a href="/2021/08/26/dockerOfDeploy/" class="title">docker实现企业服务负载均衡架构</a>
              </p>
              <p class="item-date">
                <time datetime="2021-08-26T05:31:04.000Z" itemprop="datePublished">2021-08-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2021/08/26/PerceptionAndControl/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
              </p>
              <p class="item-title">
                <a href="/2021/08/26/PerceptionAndControl/" class="title">感知与控制（快递柜）</a>
              </p>
              <p class="item-date">
                <time datetime="2021-08-26T05:29:47.000Z" itemprop="datePublished">2021-08-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2021/08/26/androidAndIoT/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
              </p>
              <p class="item-title">
                <a href="/2021/08/26/androidAndIoT/" class="title">远程数据采集控制（android）</a>
              </p>
              <p class="item-date">
                <time datetime="2021-08-26T05:28:03.000Z" itemprop="datePublished">2021-08-26</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81GitHub"><span class="toc-number">1.</span> <span class="toc-text">4、GitHub</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%AF%8D%E5%90%AB%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">常用词含义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">公式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stars%E6%88%96fork%E6%95%B0%E9%87%8F%E5%85%B3%E9%94%AE%E8%AF%8D%E5%8E%BB%E6%9F%A5%E6%89%BE"><span class="toc-number">1.2.</span> <span class="toc-text">stars或fork数量关键词去查找</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">公式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awesome%E5%8A%A0%E5%BC%BA%E6%90%9C%E7%B4%A2"><span class="toc-number">1.3.</span> <span class="toc-text">awesome加强搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">公式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA%E6%9F%90%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.</span> <span class="toc-text">高亮显示某一行代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">公式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%9F%90%E4%B8%AA%E5%9C%B0%E5%8C%BA%E5%86%85%E7%9A%84%E5%A4%A7%E4%BD%AC"><span class="toc-number">1.5.</span> <span class="toc-text">搜索某个地区内的大佬</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%BC%8F-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">公式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B9%8BMQ"><span class="toc-number">2.</span> <span class="toc-text">5、消息中间件之MQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">2.1.</span> <span class="toc-text">常见面试题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BD%9C%E4%B8%BA%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%A0%E4%BB%AC%E6%98%AF%E6%80%8E%E4%B9%88%E5%88%A4%E6%96%AD%E7%9A%84%EF%BC%9F%E8%BF%98%E6%98%AF%E8%AF%B4%E4%BD%A0%E8%BF%9B%E5%8E%BB%E5%85%AC%E5%8F%B8%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%85%AC%E5%8F%B8%E8%A6%81%E4%BD%A0%E7%94%A8%E8%BF%99%E4%B8%AA%E4%BD%A0%E5%B0%B1%E7%94%A8%E8%BF%99%E4%B8%AA%EF%BC%9F%E8%AF%B7%E9%97%AE%E4%BD%A0%E6%9C%89%E6%B2%A1%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%8B%AC%E7%AB%8B%E8%A7%81%E8%A7%A3%E5%92%8C%E6%80%9D%E8%80%83%EF%BC%9F"><span class="toc-number">2.1.0.1.</span> <span class="toc-text">1、作为技术选型的时候，你们是怎么判断的？还是说你进去公司以后，公司要你用这个你就用这个？请问你有没有自己的独立见解和思考？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%B8%AA%E6%B6%88%E6%81%AF%E9%87%8C%E9%9D%A2%EF%BC%8C%E4%B8%A4%E5%A4%A7%E7%BB%8F%E5%85%B8%E7%9A%84Queue%E9%98%9F%E5%88%97%E5%92%8CTopic%E4%B8%BB%E9%A2%98%EF%BC%8C%E8%BF%99%E4%B8%A4%E8%80%85%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F%E8%AF%B7%E8%B0%88%E8%B0%88%E4%BD%A0%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">2.1.0.2.</span> <span class="toc-text">2、对于这个消息里面，两大经典的Queue队列和Topic主题，这两者有什么区别？请谈谈你的理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81ActiveMQ%E7%9A%84%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.0.3.</span> <span class="toc-text">3、ActiveMQ的默认端口是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.0.4.</span> <span class="toc-text">4、消息队列的主要作用是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E4%BD%A0%E7%94%9F%E4%BA%A7%E4%B8%8A%E7%9A%84%E9%93%BE%E6%8E%A5%E5%8D%8F%E8%AE%AE%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E7%9A%84%EF%BC%9F%E6%98%AF%E4%BD%BF%E7%94%A8tcp%E5%90%97%EF%BC%9F"><span class="toc-number">2.1.0.5.</span> <span class="toc-text">5、你生产上的链接协议如何配置的？是使用tcp吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E9%BB%98%E8%AE%A4%E7%9A%8461616%E7%AB%AF%E5%8F%A3%E4%BB%A5%E5%8F%8Aweb%E9%A1%B5%E9%9D%A2%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%9C%A8%E5%93%AA%E4%BF%AE%E6%94%B9"><span class="toc-number">2.1.0.6.</span> <span class="toc-text">6、默认的61616端口以及web页面的端口在哪修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81kafka-activemq%EF%BC%8Crabbitmq%EF%BC%8Crocketmq%E9%83%BD%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">2.1.0.7.</span> <span class="toc-text">7、kafka activemq，rabbitmq，rocketmq都有什么区别？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E4%BD%A0%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%94%A8%E5%85%B6%E4%BB%96%E7%9A%84MQ%EF%BC%8C%E6%9C%80%E7%BB%88%E9%80%89%E6%8B%A9%E4%BA%86%E7%94%A8ActiveMQ%EF%BC%9F"><span class="toc-number">2.1.0.8.</span> <span class="toc-text">8、你们为什么不用其他的MQ，最终选择了用ActiveMQ？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81ActiveMQ%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E8%AF%B7%E4%BD%A0%E8%B0%88%E8%B0%88%EF%BC%9F"><span class="toc-number">2.1.0.9.</span> <span class="toc-text">9、ActiveMQ的持久化机制请你谈谈？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E3%80%81%E8%AF%B7%E4%BD%A0%E8%B0%88%E8%B0%88ActiveMQ%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6KahaDB%E7%9A%84%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.0.10.</span> <span class="toc-text">10、请你谈谈ActiveMQ默认存储机制KahaDB的原理是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E3%80%81%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%94%9F%E4%BA%A7%E7%AB%AF%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E6%AF%94%E8%BE%83%E5%BF%AB%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%A6%81%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E8%83%BD%E5%8F%91%E9%80%81%E6%88%90%E5%8A%9F%EF%BC%9F"><span class="toc-number">2.1.0.11.</span> <span class="toc-text">11、你是如何保证生产端发送消息比较快，并且要保证消息能发送成功？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12%E3%80%81%E8%AF%B7%E4%BD%A0%E8%B0%88%E8%B0%88MQ%E5%BD%93%E4%B8%AD%E5%85%B7%E4%BD%93%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%BC%9A%E5%BC%95%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E9%87%8D%E5%8F%91%EF%BC%9F"><span class="toc-number">2.1.0.12.</span> <span class="toc-text">12、请你谈谈MQ当中具体哪些情况会引发消息的重发？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13%E3%80%81%E8%AF%B7%E8%AF%B4%E8%AF%B4%E6%B6%88%E6%81%AF%E9%87%8D%E5%8F%91%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E5%92%8C%E9%87%8D%E5%8F%91%E6%AC%A1%E6%95%B0%EF%BC%9F"><span class="toc-number">2.1.0.13.</span> <span class="toc-text">13、请说说消息重发时间间隔和重发次数？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14%E3%80%81MQ%E7%9A%84%E6%9C%89%E6%AF%92%E6%B6%88%E6%81%AF%E8%B0%88%E8%B0%88%E4%BD%A0%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">2.1.0.14.</span> <span class="toc-text">14、MQ的有毒消息谈谈你的理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15%E3%80%81%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">2.1.0.15.</span> <span class="toc-text">15、谈谈你对死信队列的理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E3%80%81%E4%BD%A0%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%EF%BC%9F"><span class="toc-number">2.1.0.16.</span> <span class="toc-text">16、你在项目中是如何保证消息队列的高可用？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%EF%BC%8C%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81MQ%E5%B9%82%E7%AD%89%E6%80%A7%EF%BC%9F"><span class="toc-number">2.1.0.17.</span> <span class="toc-text">17、消费者消费消息，如何保证MQ幂等性？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%9C%A8%E7%B3%BB%E7%BB%9F%E9%87%8C%E5%BC%95%E5%85%A5%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">2.1.0.18.</span> <span class="toc-text">18、为什么要在系统里引入消息中间件?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19%E3%80%81%E4%BD%95%E7%A7%8D%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%E4%BA%86%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%9F"><span class="toc-number">2.1.0.19.</span> <span class="toc-text">19、何种场景下使用了消息中间件？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20%E3%80%81%E5%A6%82%E6%9E%9C%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%B6%88%E6%81%AF%E5%A4%A7%E9%87%8F%E7%A7%AF%E5%8E%8B%E4%BA%86%EF%BC%8C%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%9A%84%EF%BC%9F"><span class="toc-number">2.1.0.20.</span> <span class="toc-text">20、如果消息中间件的消息大量积压了，你是如何处理的？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E5%A4%A7%E9%87%8F%E7%9A%84%E7%A7%AF%E5%8E%8B%EF%BC%9F"><span class="toc-number">2.1.0.20.1.</span> <span class="toc-text">为什么会导致消息大量的积压？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E7%9A%84%E7%A7%AF%E5%8E%8B%EF%BC%9F"><span class="toc-number">2.1.0.20.2.</span> <span class="toc-text">什么情况下会导致消息的积压？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">2.1.0.20.3.</span> <span class="toc-text">怎么解决消息积压的问题？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#21%E3%80%81MQ%E5%9C%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E6%83%85%E5%86%B5%E4%B8%8B%E5%81%87%E8%AE%BE%E9%98%9F%E5%88%97%E6%BB%A1%E4%BA%86%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%A2%E5%A4%B1%EF%BC%9F"><span class="toc-number">2.1.0.21.</span> <span class="toc-text">21、MQ在高并发情况下假设队列满了如何防止消息的丢失？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%A2%E5%A4%B1%EF%BC%9F"><span class="toc-number">2.1.0.21.1.</span> <span class="toc-text">为什么会导致消息的丢失？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%A2%E5%A4%B1%EF%BC%9F"><span class="toc-number">2.1.0.21.2.</span> <span class="toc-text">什么情况下会导致消息的丢失？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F%E9%82%A3%E4%B9%88%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%80%E5%AE%9A%E5%8F%91%E5%87%BA%E5%8E%BB%E5%91%A2%EF%BC%9F"><span class="toc-number">2.1.0.21.3.</span> <span class="toc-text">怎么解决消息丢失的问题？那么如何保证消息一定发出去呢？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">2.1.0.21.4.</span> <span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22%E3%80%81MQ%E5%9C%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8B%E8%8B%A5%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E4%BA%86%EF%BC%8C%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%9A%84%EF%BC%9F"><span class="toc-number">2.1.0.22.</span> <span class="toc-text">22、MQ在高并发下若消息重复了，你是如何处理的？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E7%9A%84%E9%87%8D%E5%A4%8D%EF%BC%9F"><span class="toc-number">2.1.0.22.1.</span> <span class="toc-text">为什么会导致消息的重复？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%B6%88%E6%81%AF%E7%9A%84%E9%87%8D%E5%A4%8D%EF%BC%9F"><span class="toc-number">2.1.0.22.2.</span> <span class="toc-text">什么情况下会导致消息的重复？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">2.1.0.22.3.</span> <span class="toc-text">怎么解决消息重复的问题？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81MySQL%E7%9B%B8%E5%85%B3-%E5%BE%85%E6%9B%B4%E6%96%B0"><span class="toc-number">3.</span> <span class="toc-text">6、MySQL相关(待更新)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">3.1.</span> <span class="toc-text">面试题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81mysql5-5%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">1、mysql5.5以上的存储引擎是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88mysql5-5%E4%BB%A5%E5%90%8E%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%BC%9A%E9%80%89%E6%8B%A9%E8%BF%99%E4%B8%AA%E4%BD%9C%E4%B8%BA%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%91%A2%EF%BC%9F"><span class="toc-number">3.1.0.2.</span> <span class="toc-text">2、为什么mysql5.5以后的存储引擎会选择这个作为存储引擎呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%AF%B7%E8%B0%88%E8%B0%88InnoDB%E5%92%8CMyISAM%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9%EF%BC%8C%E5%B9%B6%E8%B0%88%E8%B0%88%E4%BD%A0%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">3.1.0.3.</span> <span class="toc-text">3、请谈谈InnoDB和MyISAM优点和缺点，并谈谈你的理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E8%AF%B7%E9%97%AE%E5%BD%93%E4%BD%A0%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AAsql%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%9C%A8Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%95%E5%B1%82%E6%98%AF%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD%E5%B9%B6%E8%BF%90%E8%A1%8C%E7%9A%84%EF%BC%9F"><span class="toc-number">3.1.0.4.</span> <span class="toc-text">4、请问当你写了一个sql以后，在Mysql数据库底层是如何加载并运行的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E8%AF%B7%E9%97%AEJoin%E6%98%AF%E6%9C%89%E5%87%A0%E7%A7%8D%EF%BC%9F"><span class="toc-number">3.1.0.5.</span> <span class="toc-text">5、请问Join是有几种？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E7%B4%A2%E5%BC%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">3.1.0.6.</span> <span class="toc-text">6、索引是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%BB%BA%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-number">3.1.0.6.1.</span> <span class="toc-text">为什么要建索引？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E9%80%82%E5%90%88%E5%BB%BA%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-number">3.1.0.6.2.</span> <span class="toc-text">哪些情况下适合建索引？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E4%B8%8D%E9%80%82%E5%90%88%E5%BB%BA%E7%B4%A2%E5%BC%95%EF%BC%9F"><span class="toc-number">3.1.0.6.3.</span> <span class="toc-text">哪些情况下不适合建索引？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E3%80%81NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">4.</span> <span class="toc-text">7、NoSQL数据库Redis实现分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%A1%A5%E5%85%85"><span class="toc-number">4.1.</span> <span class="toc-text">基础补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="toc-number">4.1.1.</span> <span class="toc-text">1、查询缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">4.1.2.</span> <span class="toc-text">2、缓存问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%82%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">1。缓存穿透</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%82%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">2。缓存雪崩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%82%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">3。缓存击穿</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">4.1.3.</span> <span class="toc-text">3、分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.1.4.</span> <span class="toc-text">4、缓存使用模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache-Aside"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">Cache-Aside</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache-As-SoR"><span class="toc-number">4.1.4.2.</span> <span class="toc-text">Cache As SoR</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-amp-%E9%9B%86%E5%90%88%E8%90%BD%E5%9C%B0%E5%AE%9E%E7%8E%B0%E2%80%94-Redisson"><span class="toc-number">4.1.5.</span> <span class="toc-text">5、分布式锁&amp;集合落地实现—-Redisson</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%90%84%E7%A7%8D%E9%94%81"><span class="toc-number">4.1.6.</span> <span class="toc-text">6、各种锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%94%81%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E5%B9%B2%E4%BB%80%E4%B9%88%E7%94%A8%EF%BC%9F"><span class="toc-number">4.1.6.1.</span> <span class="toc-text">1、锁是什么？干什么用？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E7%9F%A5%E9%81%93%E4%B8%8B%E9%9D%A2%E8%BF%99%E4%BA%9B%E9%94%81%E5%90%97%EF%BC%9F"><span class="toc-number">4.1.6.2.</span> <span class="toc-text">2、知道下面这些锁吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Synchronized"><span class="toc-number">4.1.6.3.</span> <span class="toc-text">Synchronized</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lock"><span class="toc-number">4.1.6.4.</span> <span class="toc-text">Lock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReentrantLock%E4%B8%8Esynchronized-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.1.6.5.</span> <span class="toc-text">ReentrantLock与synchronized 的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReentrantLock%E8%8E%B7%E5%8F%96%E9%94%81%E5%AE%9A%E6%9C%89%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.6.6.</span> <span class="toc-text">ReentrantLock获取锁定有三种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AC%E5%B9%B3%E9%94%81-%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81"><span class="toc-number">4.1.6.7.</span> <span class="toc-text">公平锁&#x2F;非公平锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%90%E8%A7%82%E9%94%81-%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">4.1.6.8.</span> <span class="toc-text">乐观锁&#x2F;悲观锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8B%AC%E4%BA%AB%E9%94%81-%E5%85%B1%E4%BA%AB%E9%94%81"><span class="toc-number">4.1.6.9.</span> <span class="toc-text">独享锁&#x2F;共享锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%92%E6%96%A5%E9%94%81-%E8%AF%BB%E5%86%99%E9%94%81"><span class="toc-number">4.1.6.10.</span> <span class="toc-text">互斥锁&#x2F;读写锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E6%97%8B%E9%94%81-%E8%87%AA%E9%80%82%E5%BA%94%E8%87%AA%E6%97%8B%E9%94%81"><span class="toc-number">4.1.6.11.</span> <span class="toc-text">自旋锁&#x2F;自适应自旋锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81%E7%B2%97%E5%8C%96-%E9%94%81%E6%B6%88%E9%99%A4"><span class="toc-number">4.1.6.12.</span> <span class="toc-text">锁粗化&#x2F;锁消除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%8F%E5%90%91%E9%94%81-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81-%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81"><span class="toc-number">4.1.6.13.</span> <span class="toc-text">偏向锁&#x2F;轻量级锁&#x2F;重量级锁</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%8A%80%E6%9C%AFZookeeper%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">5.</span> <span class="toc-text">8、分布式协调技术Zookeeper实现分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#zookeeper%E5%AE%9E%E7%8E%B0%E8%BF%87%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%90%97%EF%BC%9F"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">zookeeper实现过分布式锁吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%AE%A2%E5%8D%95%E5%8F%B7%E7%94%9F%E6%88%90%E7%9A%84%E9%87%8D%E5%A4%8D%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">分布式情况下，怎么解决订单号生成的重复问题？</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9%E3%80%81SpringCloud-Alibaba%E7%B3%BB%E5%88%97"><span class="toc-number">6.</span> <span class="toc-text">9、SpringCloud Alibaba系列</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Nacos-spring-cloud-alibaba"><span class="toc-number">6.1.</span> <span class="toc-text">1. Nacos[spring cloud alibaba]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringCloud-Gateway"><span class="toc-number">6.2.</span> <span class="toc-text">2. SpringCloud Gateway</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95"><span class="toc-number">6.3.</span> <span class="toc-text">面试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%9F"><span class="toc-number">6.3.0.1.</span> <span class="toc-text">3.你是怎么解决分布式事务？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E9%82%A3%E8%AF%B7%E4%BD%A0%E8%AF%B4%E8%AF%B4%E4%BD%A0%E5%AF%B9Seata%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">6.3.0.2.</span> <span class="toc-text">4.那请你说说你对Seata的理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%82%A3TC%EF%BC%8CTM%EF%BC%8CRM%E6%98%AF%E6%80%8E%E4%B9%88%E5%8D%8F%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">6.3.0.3.</span> <span class="toc-text">5.那TC，TM，RM是怎么协作的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-SpringCloud-Alibaba%E5%92%8CSpring%E5%9B%A2%E9%98%9F%E7%A0%94%E5%8F%91%E7%9A%84SpringCloud%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">6.3.0.4.</span> <span class="toc-text">6.SpringCloud Alibaba和Spring团队研发的SpringCloud有什么区别？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-SpringCloud%E5%92%8CSpringBoot%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-number">6.3.0.5.</span> <span class="toc-text">7.SpringCloud和SpringBoot的区别和关系？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%86%94%E6%96%AD%EF%BC%9F"><span class="toc-number">6.3.0.6.</span> <span class="toc-text">什么是服务的熔断？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%99%8D%E7%BA%A7%EF%BC%9F"><span class="toc-number">6.3.0.7.</span> <span class="toc-text">什么是服务的降级？</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10%E3%80%81%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1-amp-amp-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">10、本地事务&amp;&amp;分布式事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">7.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1"><span class="toc-number">7.1.1.</span> <span class="toc-text">本地事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-number">7.1.2.</span> <span class="toc-text">分布式事务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11%E3%80%81Spring%E7%AD%89%E9%AB%98%E7%BA%A7%E6%A1%86%E6%9E%B6%E5%A4%8D%E4%B9%A0"><span class="toc-number">8.</span> <span class="toc-text">11、Spring等高级框架复习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC"><span class="toc-number">8.1.</span> <span class="toc-text">SpringMVC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot"><span class="toc-number">8.2.</span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">8.2.1.</span> <span class="toc-text">1.SpringBoot自动配置原理:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SpringBoot%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">8.2.2.</span> <span class="toc-text">2.SpringBoot创建及运行原理:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12%E3%80%812020%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%A4%8D%E4%B9%A0"><span class="toc-number">9.</span> <span class="toc-text">12、2020谷粒商城项目复习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">9.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8FSession%E4%B8%8D%E5%85%B1%E4%BA%AB%E4%B8%8D%E5%90%8C%E6%AD%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">9.1.1.</span> <span class="toc-text">分布式Session不共享不同步的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E5%95%86%E7%99%BB%E5%BD%95%E5%90%8Esession%E5%85%B1%E4%BA%AB%E7%9A%84%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B"><span class="toc-number">9.1.2.</span> <span class="toc-text">电商登录后session共享的整个过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E3%80%82%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D%E5%BD%93%E4%B8%AD%E5%85%B6%E4%B8%80%E6%AC%A1%E7%99%BB%E5%BD%95%EF%BC%8C%E5%A4%84%E5%A4%84%E5%8F%AF%E7%94%A8%EF%BC%9F"><span class="toc-number">9.1.3.</span> <span class="toc-text">单点登录。怎么实现在不同域名当中其一次登录，处处可用？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E4%B8%80%E4%B8%AA%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">9.1.3.0.1.</span> <span class="toc-text">有一个核心服务器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E6%89%80%E6%9C%89%E7%B3%BB%E7%BB%9F%E5%9F%9F%E5%90%8D%E9%83%BD%E4%B8%8D%E7%9B%B8%E5%90%8C%EF%BC%8C%E8%BF%98%E8%83%BD%E8%BE%BE%E5%88%B0%E4%B8%80%E5%A4%84%E7%99%BB%E5%BD%95%EF%BC%8C%E5%A4%84%E5%A4%84%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95%E5%91%A2%EF%BC%9F"><span class="toc-number">9.1.3.1.</span> <span class="toc-text">怎么解决所有系统域名都不相同，还能达到一处登录，处处自动登录呢？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">9.1.4.</span> <span class="toc-text">购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%A6%BB%E7%BA%BF%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">9.1.4.1.</span> <span class="toc-text">3、离线购物车</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%9C%A8%E7%BA%BF%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">9.1.4.2.</span> <span class="toc-text">4、在线购物车</span></a></li></ol></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-java-2021-08-15-faceQuestions2" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      面试题2
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/08/01/java-2021-08-15-faceQuestions2/" class="article-date">
	  <time datetime="2021-08-01T12:56:06.000Z" itemprop="datePublished">2021-08-01</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/java/">java</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/java/" rel="tag">java</a>, <a class="article-tag-link-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/08/01/java-2021-08-15-faceQuestions2/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 33k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 129(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="4、GitHub"><a href="#4、GitHub" class="headerlink" title="4、GitHub"></a>4、GitHub</h1><h2 id="常用词含义"><a href="#常用词含义" class="headerlink" title="常用词含义"></a>常用词含义</h2><p>watch: 会持续收到该项目的动态</p>
<p>fork，复制某个项目到自己的github仓库中</p>
<p>star,可以理解为点赞</p>
<p>clone，将项目下载至本地</p>
<p>follow，关注你感兴趣的作者，会收到他们的动态</p>
<p>in关键词限制搜索范围</p>
<h3 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h3><p> xxx关键词 in:name或description或readme</p>
<p>xxx in:name项目名包含xxx的</p>
<p>xxx in:description项目描述包含xxx的</p>
<p>xxx in:readme项目的readme文件中包含xxx的</p>
<p>组合使用</p>
<p>搜索项目名或者readme中包含秒杀的项目</p>
<p>seckill in:name,readme</p>
<h2 id="stars或fork数量关键词去查找"><a href="#stars或fork数量关键词去查找" class="headerlink" title="stars或fork数量关键词去查找"></a>stars或fork数量关键词去查找</h2><h3 id="公式-1"><a href="#公式-1" class="headerlink" title="公式"></a>公式</h3><p>xxx关键词 stars 通配符</p>
<p>:&gt; 或者 :&gt;=</p>
<p>区间范围数字<br>数字1..数字2</p>
<p>查找stars数大于等于5000的springboot项目<br>springboot stars:&gt;=5000</p>
<p>查找forks数大于500的springcloud项目<br>springcloud forks:&gt;500</p>
<p>组合使用</p>
<p>查找ifork在100到200之间并且stars数在80到100之间的springboot项目<br>springboot forks:100..200 stars:80..100</p>
<h2 id="awesome加强搜索"><a href="#awesome加强搜索" class="headerlink" title="awesome加强搜索"></a>awesome加强搜索</h2><h3 id="公式-2"><a href="#公式-2" class="headerlink" title="公式"></a>公式</h3><p>awesome 关键字</p>
<p>awesome 系列 一般是用来收集学习，工具，书籍类相关的项目</p>
<p>搜索优秀的redis相关的项目，包括框架，教程等</p>
<h2 id="高亮显示某一行代码"><a href="#高亮显示某一行代码" class="headerlink" title="高亮显示某一行代码"></a>高亮显示某一行代码</h2><h3 id="公式-3"><a href="#公式-3" class="headerlink" title="公式"></a>公式</h3><p>1行<br>地址后面紧跟#L数字</p>
<p>多行<br>地址后面紧跟#L数字-L数字2</p>
<p>项目内搜索</p>
<p>英文<br> <a target="_blank" rel="noopener" href="https://help.github.com/en/articles/using-keyboard-shortcuts">https://help.github.com/en/articles/using-keyboard-shortcuts</a></p>
<h2 id="搜索某个地区内的大佬"><a href="#搜索某个地区内的大佬" class="headerlink" title="搜索某个地区内的大佬"></a>搜索某个地区内的大佬</h2><h3 id="公式-4"><a href="#公式-4" class="headerlink" title="公式"></a>公式</h3><p>location:地区<br>language:语言</p>
<p>地区北京的java方向的用户<br>location:beijing language:java</p>
<h1 id="5、消息中间件之MQ"><a href="#5、消息中间件之MQ" class="headerlink" title="5、消息中间件之MQ"></a>5、消息中间件之MQ</h1><h2 id="常见面试题"><a href="#常见面试题" class="headerlink" title="常见面试题"></a>常见面试题</h2><h4 id="1、作为技术选型的时候，你们是怎么判断的？还是说你进去公司以后，公司要你用这个你就用这个？请问你有没有自己的独立见解和思考？"><a href="#1、作为技术选型的时候，你们是怎么判断的？还是说你进去公司以后，公司要你用这个你就用这个？请问你有没有自己的独立见解和思考？" class="headerlink" title="1、作为技术选型的时候，你们是怎么判断的？还是说你进去公司以后，公司要你用这个你就用这个？请问你有没有自己的独立见解和思考？"></a>1、作为技术选型的时候，你们是怎么判断的？还是说你进去公司以后，公司要你用这个你就用这个？请问你有没有自己的独立见解和思考？</h4><p>答:  我刚入行的时候，人为年轻，也没有这个能力这个权限去做我们公司项目的技术选型，经理让我们用什么我们就用什么，但是我现在深度了解过ActiveMQ。我在公司用ActiveMQ的时候都接触过api发送和接收，MQ的高可用性，集群容错，持久化等功能，如果贵公司用ActiveMQ这款产品最好，如果不用，我也相信其他MQ也会支持像ActiveMQ的高可用，集群容错等功能，因为技术维度都是相通的。</p>
<h4 id="2、对于这个消息里面，两大经典的Queue队列和Topic主题，这两者有什么区别？请谈谈你的理解？"><a href="#2、对于这个消息里面，两大经典的Queue队列和Topic主题，这两者有什么区别？请谈谈你的理解？" class="headerlink" title="2、对于这个消息里面，两大经典的Queue队列和Topic主题，这两者有什么区别？请谈谈你的理解？"></a>2、对于这个消息里面，两大经典的Queue队列和Topic主题，这两者有什么区别？请谈谈你的理解？</h4><p>答:  Queue队列是以数据默认存储在MQ服务器上文件形式保存起来，也可以用数据库进行存储。它采用的是负载均衡的模式，若当前没有消费者，消息也不会被丢弃。如果有多个消费者，那一个消息就只会发送给其中一个消费者。</p>
<p>Topic它是无状态的发布订阅模式，若没有订阅者，那么消息就直接被丢弃，如果有多个订阅者，那么这些订阅者就都会收到消息，但是性能会降低，因为它是按照订阅者数量进行复制数据来发送的。</p>
<h4 id="3、ActiveMQ的默认端口是什么？"><a href="#3、ActiveMQ的默认端口是什么？" class="headerlink" title="3、ActiveMQ的默认端口是什么？"></a>3、ActiveMQ的默认端口是什么？</h4><p>ActiveMQ两大经典默认的端口是61616和8161</p>
<h4 id="4、消息队列的主要作用是什么？"><a href="#4、消息队列的主要作用是什么？" class="headerlink" title="4、消息队列的主要作用是什么？"></a>4、消息队列的主要作用是什么？</h4><p>削锋<br>解耦<br>异步</p>
<p>它能对多个模块进行解耦，对相关高并发场景进行削峰以及消息的异步处理</p>
<h4 id="5、你生产上的链接协议如何配置的？是使用tcp吗？"><a href="#5、你生产上的链接协议如何配置的？是使用tcp吗？" class="headerlink" title="5、你生产上的链接协议如何配置的？是使用tcp吗？"></a>5、你生产上的链接协议如何配置的？是使用tcp吗？</h4><p>答：还用过NIO，它类似于TCP传输协议，但是它是用的是非阻塞型NIO，它有比TCP更好的性能</p>
<h4 id="6、默认的61616端口以及web页面的端口在哪修改"><a href="#6、默认的61616端口以及web页面的端口在哪修改" class="headerlink" title="6、默认的61616端口以及web页面的端口在哪修改"></a>6、默认的61616端口以及web页面的端口在哪修改</h4><p>答：可以在ActiveMQ的conf文件夹下的ActiveMQ.xml当中进行修改61616进程端口，以及在conf文件夹下的jetty.xml进行修改web页面的端口</p>
<h4 id="7、kafka-activemq，rabbitmq，rocketmq都有什么区别？"><a href="#7、kafka-activemq，rabbitmq，rocketmq都有什么区别？" class="headerlink" title="7、kafka activemq，rabbitmq，rocketmq都有什么区别？"></a>7、kafka activemq，rabbitmq，rocketmq都有什么区别？</h4><p>1、我就说说我用过的ActiveMQ，ActiveMQ是Apache下的产品，它支持JAVA，它自身是JAVA开发出来的产品，而Apache跟我们JAVA程序员是耍不掉的，我们用的很多产品也都是Apache下的，比如Tomcat这些产品，所以它对于我们的入门学习的提升非常有帮助。它有较低的概念数据丢失，但是这个可以控制的。可能等到ActiveMQ6.0出来了以后，可能会更完善了一些，但现在如果比起阿里巴巴的RocketMQ，这个ActiveMQ没有RocketMQ好。2、因为RocketMQ是阿里的产品，它模仿了kafka的精华，进行改造出来的产品，也是得到阿里双十一验证的较为成熟的产品。</p>
<p>3、而kafka是大数据场景下用到的产品，它是支持十万级别的吞吐量，但是它似乎会丢失一些数据的概率大一些吧</p>
<p>4、而RabbitMQ是其他语言开发的，若改它源码可能使我们JAVA程序员较为麻烦。扩展性可能就不是很好。</p>
<h4 id="8、你们为什么不用其他的MQ，最终选择了用ActiveMQ？"><a href="#8、你们为什么不用其他的MQ，最终选择了用ActiveMQ？" class="headerlink" title="8、你们为什么不用其他的MQ，最终选择了用ActiveMQ？"></a>8、你们为什么不用其他的MQ，最终选择了用ActiveMQ？</h4><p>因为ActiveMQ是Apache下的产品，它支持JAVA，它自身是JAVA开发出来的产品，而Apache 跟我们JAVA程序员是耍不掉的，我们用的很多 产品也都是Apache的，比如Tomcat这些产品，所以它对于我们的入门学习的提升非常有帮助并且扩展性较好。它有较低的概念数据丢失，但是这个可以控制的。可能等到下一代的ActiveMQ6.0出来了以后，可能会更加完善了一些</p>
<h4 id="9、ActiveMQ的持久化机制请你谈谈？"><a href="#9、ActiveMQ的持久化机制请你谈谈？" class="headerlink" title="9、ActiveMQ的持久化机制请你谈谈？"></a>9、ActiveMQ的持久化机制请你谈谈？</h4><p>答：MQ自身也带有持久化机制，并且MQ默认的就是KahaDB以日志文件进行存储的，但是这种自带的持久化机制也不可靠，因为若一旦MQ宕机了，就算自带可持久化机制也需要重启恢复，所以为了保证高可用，为了保证可靠性。MQ一般都会采用数据库存储等方式进行更为保障的持久化。</p>
<h4 id="10、请你谈谈ActiveMQ默认存储机制KahaDB的原理是什么？"><a href="#10、请你谈谈ActiveMQ默认存储机制KahaDB的原理是什么？" class="headerlink" title="10、请你谈谈ActiveMQ默认存储机制KahaDB的原理是什么？"></a>10、请你谈谈ActiveMQ默认存储机制KahaDB的原理是什么？</h4><p>1、KahaDB里面有四类文件一把锁，其中一个db-1.log是日志文件，当这个日志文件满了以后，会新增一个新的日志文件，并在日志文件名称中按照数字进行编号，若不再引用该日志文件了，该日志文件就会被删除或者是归档。</p>
<p>2、db.data是索引，他用来存储日志文件记录的具体索引位置的。</p>
<p>3、db.free是看db.data索引文件当中是有有空闲</p>
<p>4、lock是读取该KahaDB的一把权限锁。</p>
<h4 id="11、你是如何保证生产端发送消息比较快，并且要保证消息能发送成功？"><a href="#11、你是如何保证生产端发送消息比较快，并且要保证消息能发送成功？" class="headerlink" title="11、你是如何保证生产端发送消息比较快，并且要保证消息能发送成功？"></a>11、你是如何保证生产端发送消息比较快，并且要保证消息能发送成功？</h4><p>1、若生产端发送的大量消息，消费端消费的比较慢，可以开启异步投递的方式， 有三种方法可以开启生产端的异步投递，使其性能提高，发送消息会更快</p>
<p>2、但是同时也会导致丢失数据的风险，因为生产端直接生产了消息就直接丢给了MQ，也不管MQ收到没收到，生产端这边就自认为自己已经完成了工作。但MQ一旦宕机等了，那么数据可能会丢失。</p>
<p>3、想保证消息能发送成功，要加入异步投递的同时，再加入异步接收回调方法，使其再判断是否都发送成功，若失败了就需要人工干预，继续重发。</p>
<h4 id="12、请你谈谈MQ当中具体哪些情况会引发消息的重发？"><a href="#12、请你谈谈MQ当中具体哪些情况会引发消息的重发？" class="headerlink" title="12、请你谈谈MQ当中具体哪些情况会引发消息的重发？"></a>12、请你谈谈MQ当中具体哪些情况会引发消息的重发？</h4><p>1、消费端使用事务，但是在session中调用了rollback回滚,没有真正的提交数据</p>
<p>2、消费端使用事务，但是没有提交或者是之前关闭了</p>
<p>3、消费端在使用签收的模式下，在session中调用了recover()重试的方法</p>
<p>这以上三种情况都会导致消息的重发。</p>
<h4 id="13、请说说消息重发时间间隔和重发次数？"><a href="#13、请说说消息重发时间间隔和重发次数？" class="headerlink" title="13、请说说消息重发时间间隔和重发次数？"></a>13、请说说消息重发时间间隔和重发次数？</h4><p>默认是间隔每一秒钟，消息会重发6次</p>
<h4 id="14、MQ的有毒消息谈谈你的理解？"><a href="#14、MQ的有毒消息谈谈你的理解？" class="headerlink" title="14、MQ的有毒消息谈谈你的理解？"></a>14、MQ的有毒消息谈谈你的理解？</h4><p>我的理解是：这个消息重发了6次以后，还是发送不出去，消费端就会自动给MQ一个标识，表明这个消息是有毒的消息，告诉MQ实例（broker），不要再发这个消息了。MQ实例（broker）就会把这个消息放到死信队列当中。</p>
<h4 id="15、谈谈你对死信队列的理解？"><a href="#15、谈谈你对死信队列的理解？" class="headerlink" title="15、谈谈你对死信队列的理解？"></a>15、谈谈你对死信队列的理解？</h4><p>若MQ发送的消息，发送了6次都未能发送成功，会将该消息放入到死信队列当中，相关工程师可以在这个MQ的网页端的Queue队列中查看出错的消息，然后进行人工的干预处理</p>
<h4 id="16、你在项目中是如何保证消息队列的高可用？"><a href="#16、你在项目中是如何保证消息队列的高可用？" class="headerlink" title="16、你在项目中是如何保证消息队列的高可用？"></a>16、你在项目中是如何保证消息队列的高可用？</h4><p>答：是用事务，签收，持久化和zookeeper+replicated-leveldb-store的主从集群来保证MQ的高可用</p>
<h4 id="17、消费者消费消息，如何保证MQ幂等性？"><a href="#17、消费者消费消息，如何保证MQ幂等性？" class="headerlink" title="17、消费者消费消息，如何保证MQ幂等性？"></a>17、消费者消费消息，如何保证MQ幂等性？</h4><p>1、若MQ的消息是可以落盘到数据库的，可以在数据库当中设置唯一的ID主键，这样就算出现了重复消费的情况，也会导致主键的冲突。避免数据库会出现脏数据。不过这个并不推荐</p>
<p>2、推荐用redis缓存来做，给消息分配一个全局的id，只要是消费过的消息，就放入redis当中，那么消费者在开始消费前，先去redis中查询有没有消费的记录。</p>
<h4 id="18、为什么要在系统里引入消息中间件"><a href="#18、为什么要在系统里引入消息中间件" class="headerlink" title="18、为什么要在系统里引入消息中间件?"></a>18、为什么要在系统里引入消息中间件?</h4><p>1、它能够解决系统耦合调用的问题</p>
<p>2、它能够解决系统RPC同步调用的问题异步模型</p>
<p>3、它能够抵御洪峰流量，达到保护主业务的目的。</p>
<h4 id="19、何种场景下使用了消息中间件？"><a href="#19、何种场景下使用了消息中间件？" class="headerlink" title="19、何种场景下使用了消息中间件？"></a>19、何种场景下使用了消息中间件？</h4><p>1、只要是消息发送，尽量都是异步，所以可以引入消息中间件</p>
<p>2、只要是系统解耦，尽量都可以引入消息中间件</p>
<h4 id="20、如果消息中间件的消息大量积压了，你是如何处理的？"><a href="#20、如果消息中间件的消息大量积压了，你是如何处理的？" class="headerlink" title="20、如果消息中间件的消息大量积压了，你是如何处理的？"></a>20、如果消息中间件的消息大量积压了，你是如何处理的？</h4><h5 id="为什么会导致消息大量的积压？"><a href="#为什么会导致消息大量的积压？" class="headerlink" title="为什么会导致消息大量的积压？"></a>为什么会导致消息大量的积压？</h5><p>如果生产者发送消息给消息队列MQ，消费者会连上消息队列MQ服务器，进行消费消息，但是消息队列MQ里面存的消息太多，那肯定会影响很多的性能，所以消息的积压会导致MQ性能的下降，所以一定要解决消息积压的问题。</p>
<h5 id="什么情况下会导致消息的积压？"><a href="#什么情况下会导致消息的积压？" class="headerlink" title="什么情况下会导致消息的积压？"></a>什么情况下会导致消息的积压？</h5><p>1、比如消费者宕机，相当于MQ服务器没有连上任何一个消费者或者连的消费者太少了，消费者宕机了，没有消费者去消费MQ服务器当中的消息，而生产者源源不断的在生产着消息，那可能导致MQ服务器里面会有上万的消息在等着被消费</p>
<p>2、消费者消费的能力不足，假设原本有10个消费者，结果有9个消费者宕机了，最终一个消费者消费消息的效率太慢了</p>
<p>3、生产者发送的消息比较猛，消费者在消费MQ服务器当中的消息，导致可能消费者跟不上生产者生产的消息，而最终导致MQ大量的消息积压</p>
<h5 id="怎么解决消息积压的问题？"><a href="#怎么解决消息积压的问题？" class="headerlink" title="怎么解决消息积压的问题？"></a>怎么解决消息积压的问题？</h5><p>解决方案1：<br>可以限制生产者的发送流量，但是要限制流量，就要限制业务，只要业务不执行，就不发这个消息出去</p>
<p>解决方案2：<br>更可以在消费者来解决消息积压的问题，既然MQ服务器里面的消息积压了，就可以上线更多的消费者来消费消息</p>
<p>解决方案3：<br>由于可能数据量太大，如果上线更多的消费者的话，那么这个消费者如果是正常来消费消息，还要来处理，那么这个处理可能还要一段时间，就会有点慢，那么就可以上线一个专门处理消息的消费者，假设MQ有百万的消息积压，可以直接从这个专门处理消息的消费者把百万积压的消息全部批量拿出来存到数据库，然后存到数据库以后，再来编写一个离线处理消息的业务功能，从数据库里面，慢慢取出一条一条的数据进行处理。</p>
<h4 id="21、MQ在高并发情况下假设队列满了如何防止消息的丢失？"><a href="#21、MQ在高并发情况下假设队列满了如何防止消息的丢失？" class="headerlink" title="21、MQ在高并发情况下假设队列满了如何防止消息的丢失？"></a>21、MQ在高并发情况下假设队列满了如何防止消息的丢失？</h4><h5 id="为什么会导致消息的丢失？"><a href="#为什么会导致消息的丢失？" class="headerlink" title="为什么会导致消息的丢失？"></a>为什么会导致消息的丢失？</h5><p>消息的丢失是一个非常严重的现象，特别是做类似电商的业务，只要有一个消息丢失，可能会影响到后边一连串的操作都会出现问题。</p>
<p>一般使用消息事务，也就是用可靠消息+最终一致性方案，那么就应该首先保证消息的不丢失。</p>
<h5 id="什么情况下会导致消息的丢失？"><a href="#什么情况下会导致消息的丢失？" class="headerlink" title="什么情况下会导致消息的丢失？"></a>什么情况下会导致消息的丢失？</h5><p>1、消息发出去，但由于网络的问题没有抵达到MQ服务器</p>
<p>2、消息发送到MQ服务器，MQ服务器要将消息写入到磁盘才能算成功，但此时MQ服务器还没持久化这个数据也即可能还没处理这个数据，就宕机了，MQ服务器一旦宕机了以后再次启动，那么这个没有处理的数据就丢失了。</p>
<p>解决方案1：<br>使用生产者发送消息的确认机制，每一个确认成功的消息，都去数据库MQ表里面修改一下状态，改为：已收到的状态</p>
<p>3、比如生产者发送一个消息给MQ服务器，确认抵达机制已经到了MQ服务器，那么消费者此时就在消费消息，消息者刚把消息拿到，还没来得及消费，消费者却宕机了，宕机以后，此时这个消息，如果是自动确认(也即自动ACK机制的)情况下，相当于消费者已上线拿到消息就默认回复给MQ服务器：消费者已经收到了，但是其实最终却没有消费成功这个消息，那么这个消息就相当于走了一般过场而已</p>
<p>解决方案1:<br> 一定要开启手动确认机制(也即手动开启ACK机制)，消费真正成功才移除，失败或者没来得及处理就让消息重新入消息队列</p>
<h5 id="怎么解决消息丢失的问题？那么如何保证消息一定发出去呢？"><a href="#怎么解决消息丢失的问题？那么如何保证消息一定发出去呢？" class="headerlink" title="怎么解决消息丢失的问题？那么如何保证消息一定发出去呢？"></a>怎么解决消息丢失的问题？那么如何保证消息一定发出去呢？</h5><p>解决方案1：<br>可以做好容错方案，也即发送消息可能会导致网络原因而发不出去，那么就将没发送出去的消息进行重试发送</p>
<p>解决方案2:<br>做好日志记录，只要每发一个消息，都做好相应的日志记录，可以给每一个业务的数据库里面创建一张MQ的表，这个表主要保存每一个消息的详细信息，只要发送失败了，就可以定期去扫描这个MQ日志表的数据库，把这些失败的消息拿出来再发一遍</p>
<p>解决方案3:<br> 一定要开启手动确认机制(也即手动开启ACK机制)，消费真正成功才移除，失败或者没来得及处理就让消息重新入消息队列</p>
<p>解决方案4：<br>使用生产者发送消息的确认机制，每一个确认成功的消息，都去数据库MQ表里面修改一下状态，改为：已收到的状态</p>
<h5 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h5><p>做好消息的确认机制，要做两端的确认（也即消费者和生产者） 特别是消费者一定要开启手动确认机制(也即手动开启ACK机制),否则只要一收到消息，但还没有处理消息就宕机了，那么这个消息就直接被删除了。一旦做了确认机制，那么每一个发送的消息都在数据库做好记录，然后将定期所有失败的消息再次发送一遍</p>
<h4 id="22、MQ在高并发下若消息重复了，你是如何处理的？"><a href="#22、MQ在高并发下若消息重复了，你是如何处理的？" class="headerlink" title="22、MQ在高并发下若消息重复了，你是如何处理的？"></a>22、MQ在高并发下若消息重复了，你是如何处理的？</h4><h5 id="为什么会导致消息的重复？"><a href="#为什么会导致消息的重复？" class="headerlink" title="为什么会导致消息的重复？"></a>为什么会导致消息的重复？</h5><p>所谓的消息重复就是一个消息给消费者发了两次，相当于消费者收到了两次相同的消息</p>
<h5 id="什么情况下会导致消息的重复？"><a href="#什么情况下会导致消息的重复？" class="headerlink" title="什么情况下会导致消息的重复？"></a>什么情况下会导致消息的重复？</h5><p>1、消费者一般会用监听器来收到消息，一旦监听器收到消息以后，会调用业务逻辑进行处理，假设消息消费成功了，业务逻辑也处理完了，此时突然宕机了，那么下面的一些方法可能还没走完，也相当于没有给MQ服务器回复这个消息已经消费成功了，消费者就跟MQ服务器断开连接了，那么一旦断开连接，那么MQ服务器就认为消费者没有把消息消费成功，因为设置的是手动确认（ACK）机制，那么此时消息就会从Unack（正在处理）状态变成Ready（重新处理的），那么变成Ready状态，就会发给其他的消费者，相当于其他消费者收到以后，再处理，那么这个消息就相当于被处理了两遍。</p>
<p>2、消息消费失败了，然后告诉MQ服务器，拒绝消息，让这个消息重新回到队列里面，然后再来接收到进行处理，这种的消息重复处理是被允许的，因为第一遍是失败了，那么消息再次进入队列，来重新尝试消费。</p>
<h5 id="怎么解决消息重复的问题？"><a href="#怎么解决消息重复的问题？" class="headerlink" title="怎么解决消息重复的问题？"></a>怎么解决消息重复的问题？</h5><p>解决方案1：<br>将业务逻辑方法设计成幂等性的。</p>
<p>解决方案2：<br>也可以使用防重表，每一个消息由于都有一个唯一的id，只要它被处理过了，就可以去防重表里面记录一下。</p>
<p>解决方案3：<br>也可以使用RabbitMQ的消息的属性字段，来看看是不是消息是重新派发过来的，那么就可以不处理了，但是这样做太暴力了，万一上一次是失败的，没有消费成功，那么再派送过来也丢失了</p>
<p>总结:<br>如果消息重复了，把业务设计成幂等性的就行了，即使消息发上一万遍，那都是最终执行一遍的结果。</p>
<h1 id="6、MySQL相关-待更新"><a href="#6、MySQL相关-待更新" class="headerlink" title="6、MySQL相关(待更新)"></a>6、MySQL相关(待更新)</h1><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h4 id="1、mysql5-5以上的存储引擎是什么"><a href="#1、mysql5-5以上的存储引擎是什么" class="headerlink" title="1、mysql5.5以上的存储引擎是什么"></a>1、mysql5.5以上的存储引擎是什么</h4><p> 答:默认的是InnoDB存储引擎,</p>
<h4 id="2、为什么mysql5-5以后的存储引擎会选择这个作为存储引擎呢？"><a href="#2、为什么mysql5-5以后的存储引擎会选择这个作为存储引擎呢？" class="headerlink" title="2、为什么mysql5.5以后的存储引擎会选择这个作为存储引擎呢？"></a>2、为什么mysql5.5以后的存储引擎会选择这个作为存储引擎呢？</h4><p>答：因为它支持事务，行锁，支持外键，InnoDB它的高并发支持的比较好，因为要锁也只是锁一行，不是锁整张表.所以InnoDB的功能和性能会更强一些。</p>
<h4 id="3、请谈谈InnoDB和MyISAM优点和缺点，并谈谈你的理解？"><a href="#3、请谈谈InnoDB和MyISAM优点和缺点，并谈谈你的理解？" class="headerlink" title="3、请谈谈InnoDB和MyISAM优点和缺点，并谈谈你的理解？"></a>3、请谈谈InnoDB和MyISAM优点和缺点，并谈谈你的理解？</h4><p>答：现在最常用的存储引擎是InnoDB，它从Mysql5.5.5版本开始以后就成为了默认的存储引擎 InnoDB支持主外键，事务，行表锁，缓存，表的空间，而MyISAM是不支持主外键以及事务的，它在锁方面也仅仅只是支持表锁，它并不适合做高并发的操作，因为它操作一个记录的时候，会锁住整个表。 MyISAM的关注点是在性能,它偏向于查询，而InnoDB的关注点是在事务方面，它偏向于数据的稳定和持久</p>
<h4 id="4、请问当你写了一个sql以后，在Mysql数据库底层是如何加载并运行的？"><a href="#4、请问当你写了一个sql以后，在Mysql数据库底层是如何加载并运行的？" class="headerlink" title="4、请问当你写了一个sql以后，在Mysql数据库底层是如何加载并运行的？"></a>4、请问当你写了一个sql以后，在Mysql数据库底层是如何加载并运行的？</h4><p>答：Mysql默认是从FROM 先开始加载表，再从ON。然后就是JOIN，WHERE,GROUP BY, HAVING, SELECT,DISTINCT, ORDER BY ,LIMIT等其他这种顺序运行的</p>
<h4 id="5、请问Join是有几种？"><a href="#5、请问Join是有几种？" class="headerlink" title="5、请问Join是有几种？"></a>5、请问Join是有几种？</h4><p>答：粗分是有四种，左连接，右连接，内连接，外连接</p>
<h4 id="6、索引是什么？"><a href="#6、索引是什么？" class="headerlink" title="6、索引是什么？"></a>6、索引是什么？</h4><p>Mysql官方对索引的定义是：索引(Index)是帮助Mysql高效获取数据的数据结构。</p>
<h5 id="为什么要建索引？"><a href="#为什么要建索引？" class="headerlink" title="为什么要建索引？"></a>为什么要建索引？</h5><p>索引的目的在于提高查询效率。</p>
<p>索引有两大功能：查找快，排好序。也即建的索引将会影响到Sql的两部分。</p>
<p>第一部分：就是where条件后面这部分的条件约束是否用到索引，这部分就是负责查找的条件过滤。</p>
<p>第二部分：索引会影响到where后面的查找以及order by后面的排序。</p>
<h5 id="哪些情况下适合建索引？"><a href="#哪些情况下适合建索引？" class="headerlink" title="哪些情况下适合建索引？"></a>哪些情况下适合建索引？</h5><p>1.主键自动建立唯一索引。</p>
<p>2.频繁作为查询条件的字段应该建索引。</p>
<p>3.查询中与其他表关联的字段，外键关系建立索引。</p>
<p>4.频繁更新的字段不适合创建索引：因为每次更新不单单只是更新了记录，还会更新索引，加重了IO负担。</p>
<p>5.Where条件里用不到的字段不创建索引。</p>
<p>6.单键/组合索引的选择问题(高并发下倾向创建组合索引)。</p>
<p>7.查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度。</p>
<p>8.查询中统计或者分组字段。</p>
<h5 id="哪些情况下不适合建索引？"><a href="#哪些情况下不适合建索引？" class="headerlink" title="哪些情况下不适合建索引？"></a>哪些情况下不适合建索引？</h5><p>1.表记录太少。</p>
<p>2.经常增删改的表：提高了查询效率，但是同时却会降低了更新表的速度，如对表进行INSERT,UPDATE以及DELETE。因为更新表时，MySql不仅要保存数据，还要保存索引文件。</p>
<p>3.数据重复并且分布平均的表字段，因此应该只给最经常查询和最经常排序的数据列建立索引，但如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</p>
<h1 id="7、NoSQL数据库Redis实现分布式锁"><a href="#7、NoSQL数据库Redis实现分布式锁" class="headerlink" title="7、NoSQL数据库Redis实现分布式锁"></a>7、NoSQL数据库Redis实现分布式锁</h1><h2 id="基础补充"><a href="#基础补充" class="headerlink" title="基础补充"></a>基础补充</h2><h3 id="1、查询缓存"><a href="#1、查询缓存" class="headerlink" title="1、查询缓存"></a>1、查询缓存</h3><p>为了系统性能的提升，我们一般都会将数据放入缓存中，加速访问。而db承担数据落盘工作<br>整合jedis</p>
<h3 id="2、缓存问题"><a href="#2、缓存问题" class="headerlink" title="2、缓存问题"></a>2、缓存问题</h3><h4 id="1。缓存穿透"><a href="#1。缓存穿透" class="headerlink" title="1。缓存穿透"></a>1。缓存穿透</h4><p><strong>缓存穿透</strong>是指<strong>查询一个一定不存在的数据</strong>，由于缓存是不命中， 将去查询数据库，但是数据库也无此记录，并且处于容错考虑， 我们没有将这次查询的null写入缓存， 这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。 <strong>在流量大时</strong>，可能DB就挂掉了，要是有人利用不存在的key频繁攻击我们的应用，这就是漏洞。</p>
<p>解决：空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。</p>
<h4 id="2。缓存雪崩"><a href="#2。缓存雪崩" class="headerlink" title="2。缓存雪崩"></a>2。缓存雪崩</h4><p>缓存雪崩是指在我们设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB瞬时压力过重雪崩。</p>
<p>原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p>
<h4 id="3。缓存击穿"><a href="#3。缓存击穿" class="headerlink" title="3。缓存击穿"></a>3。缓存击穿</h4><p>对于一些设置了过期时间的key，如果这些key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。 这个时候，需要考虑一个问题：如果这个key在大量请求同时进来前正好失效，那么所有对这个key的数据查询都落到db，我们称为缓存击穿。</p>
<p>与缓存雪崩的区别： 缓存击穿是一个热点key失效，缓存雪崩是很多key集体失效</p>
<p>解决<br>分布式锁</p>
<h3 id="3、分布式锁"><a href="#3、分布式锁" class="headerlink" title="3、分布式锁"></a>3、分布式锁</h3><p>1、我们想要的效果</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103758003.png" alt="image-20210816103758003"></p>
<p>2、分布式锁第一阶段&amp;出现的问题</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103858610.png" alt="image-20210816103858610"></p>
<p>3、分布式锁第二阶段&amp;出现的问题</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103911056.png" alt="image-20210816103911056"></p>
<p>4、分布式锁第三阶段&amp;出现的问题</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103921742.png" alt="image-20210816103921742"></p>
<p>5、分布式锁第四阶段&amp;出现的问题</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816103937148.png" alt="image-20210816103937148"></p>
<p>6、分布式锁核心代码</p>
<p>  加锁   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String token =  UUID.randomUUID().toString();   </span><br><span class="line">String lock = jedis.set(key, token,  <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>,<span class="number">20</span>);  </span><br><span class="line">More Actions </span><br></pre></td></tr></table></figure>

<p> 解锁  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String script = <span class="string">&quot;if redis.call(&#x27;get&#x27;,  KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0  end&quot;</span>;  </span><br><span class="line">jedis.eval(script, Collections.singletonList(key),  Collections.singletonList(token)); </span><br></pre></td></tr></table></figure>

<p>  进入redis测试  <code>docker exec –it redis redis-cli  docker exec –it redis redis-benchmark  </code></p>
<h3 id="4、缓存使用模式"><a href="#4、缓存使用模式" class="headerlink" title="4、缓存使用模式"></a>4、缓存使用模式</h3><h4 id="Cache-Aside"><a href="#Cache-Aside" class="headerlink" title="Cache-Aside"></a>Cache-Aside</h4><p>即业务代码围绕Cache编写，由业务代码维护缓存；</p>
<p>读场景</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = cache.getIfPresent(key);</span><br><span class="line"><span class="keyword">if</span>(data == <span class="keyword">null</span>)&#123;</span><br><span class="line">  data = loadFromSoR(key);</span><br><span class="line">  cache.put(key,data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先从缓存中获取，没有查询SoR，再放入缓存</p>
<p>写场景</p>
<p><strong>双写模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、先将数据写入SoR</span></span><br><span class="line">writeToSoR(k,v);</span><br><span class="line"><span class="comment">//2、执行成功后立即同步写入缓存</span></span><br><span class="line">cache.put(k,v)</span><br></pre></td></tr></table></figure>

<p><strong>失效模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、先将数据写入SoR</span></span><br><span class="line">writeToSoR(k,v);</span><br><span class="line"><span class="comment">//2、失效缓存，下次读取时从缓存中加载（进入读场景），</span></span><br><span class="line">cache.invalidate(k);</span><br></pre></td></tr></table></figure>

<p>并发更新问题与解决</p>
<p>（多个缓存实例，同时更新自己里面的同样数据）</p>
<p>canal</p>
<p>1、考虑使用中间件如Canal订阅binlog，进行增量更新分布式缓存，不会存在缓存数据不一致问题。但是会有延迟，我们可以调整合理的过期时间来容忍这个延迟</p>
<p>2、读服务，可以考虑一致性哈希，相同的操作负载均衡到同一个实例，从而减少并发几率。</p>
<p>自定义数据分片规则，实现一致性hash</p>
<h4 id="Cache-As-SoR"><a href="#Cache-As-SoR" class="headerlink" title="Cache As SoR"></a>Cache As SoR</h4><p>即把Cache当做SoR，所有操作都是对Cache进行，然后Cache委托SoR进行数据的真实读写。 即业务代码只看到Cache的操作，看不到关于SoR的代码；三种实现模式：read-through、 write-through、write-behind</p>
<p>read-through</p>
<p>业务代码首先调用Cache，Cache不命中，由Cache回源到SoR（类似回调的方式或者Cache配置的方式）， 而不是业务代码。【Guava、Ehcache均支持这种模式】 优点：业务代码整洁； MyBatis缓存机制；userMapper.get(1);</p>
<p>write-through</p>
<p>称为穿透写模式/直写模式。业务代码调用Cache写数据，然后由Cache负责写缓存和写SoR，而不是业务代码。</p>
<p>MyBatis缓存机制：userMapper.update(1); 1)、直接把缓存删了或者改了 2）、再去改数据</p>
<p>write-behind（write-back）</p>
<p>也叫write-back；回写模式。不同于write-through的是，write-through是同步写，而write-back是异步写，异步成功后可以实现批量写、合并写、延时写等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.update(<span class="number">1</span>); <span class="comment">//1s</span></span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123; cache.update() <span class="comment">//3s&#125;).start();</span></span><br><span class="line">sout(<span class="string">&quot;&quot;</span>);<span class="comment">//1s后</span></span><br></pre></td></tr></table></figure>

<p>Copy-Pattern（缓存数据复制方式）</p>
<p>缓存使用两种复制模式，注意。Copy-On-Read（读时复制）、Copy-On-Write（写时复制）。</p>
<p>有些进程内缓存很多是基于引用的，所以拿到缓存中的数据如果进行修改，可能发生不可预测的问题。</p>
<p>读时复制：读取到的缓存的值，复制内容封装一个新的对象。</p>
<p>写时复制：给缓存中写的值，复制一个新的对象写入</p>
<p>名词</p>
<p>SoR（system-of-record）：记录系统，或者可以叫数据源，实际存储原始数据的系统</p>
<p>Cache：缓存，是SoR的快照数据，Cache的访问速度比SoR要快，放入Cache的目的是提升系统速度，减少回源到SoR的次数</p>
<p>回源：回到数据源头检索数据，Cache没有命中需要回到SoR读取数据，这叫做回源</p>
<h3 id="5、分布式锁-amp-集合落地实现—-Redisson"><a href="#5、分布式锁-amp-集合落地实现—-Redisson" class="headerlink" title="5、分布式锁&amp;集合落地实现—-Redisson"></a>5、分布式锁&amp;集合落地实现—-<strong>Redisson</strong></h3><p>1、简介</p>
<p>Redisson是一个在Redis的基础上实现的Java驻内存数据网格（In-Memory Data Grid）。它不仅提供了一系列的分布式的Java常用对象，还提供了许多分布式服务。其中包括(BitSet, Set, Multimap, SortedSet, Map, List, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, AtomicLong, CountDownLatch, Publish / Subscribe, Bloom filter, Remote service, Spring cache, Executor service, Live Object service, Scheduler service) Redisson提供了使用Redis的最简单和最便捷的方法。Redisson的宗旨是促进使用者对Redis的关注分离（Separation of Concern），从而让使用者能够将精力更集中地放在处理业务逻辑上。</p>
<p>2、整合</p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p>配置redis</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring.redis.host=192.168.159.130</span></span><br><span class="line"><span class="string">spring.redis.port=6379</span></span><br></pre></td></tr></table></figure>

<p>配置redisson</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GmallRedissonConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedissonClient <span class="title">redissonClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Config config = <span class="keyword">new</span> Config();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://&quot;</span>+host+<span class="string">&quot;:&quot;</span>+port);</span><br><span class="line">        RedissonClient redisson = Redisson.create(config);</span><br><span class="line">        <span class="keyword">return</span> redisson;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、文档</p>
<p> <a target="_blank" rel="noopener" href="https://github.com/redisson/redisson/wiki/1.-Overview">https://github.com/redisson/redisson/wiki/1.-Overview</a></p>
<p>4、分布式锁</p>
<p>5、分布式集合</p>
<h3 id="6、各种锁"><a href="#6、各种锁" class="headerlink" title="6、各种锁"></a>6、各种锁</h3><p>锁的基本问题</p>
<h4 id="1、锁是什么？干什么用？"><a href="#1、锁是什么？干什么用？" class="headerlink" title="1、锁是什么？干什么用？"></a>1、锁是什么？干什么用？</h4><p>锁主要用来实现资源共享的同步。只有获取到了锁才能访问该同步代码，否则等待其他线程使用结束释放锁。</p>
<p>一句话：限制多线程资源竞争</p>
<h4 id="2、知道下面这些锁吗？"><a href="#2、知道下面这些锁吗？" class="headerlink" title="2、知道下面这些锁吗？"></a>2、知道下面这些锁吗？</h4><p>自旋锁、阻塞锁、可重入锁、读写锁、互斥锁、悲观锁、乐观锁、公平锁、偏向锁、 对象锁、线程锁、锁粗化、锁消除、轻量级锁、重量级锁、信号量、 独享锁、共享锁、分段锁、闭锁</p>
<p>锁分类</p>
<p>其实我们真正用到的锁也就那么两三种，只不过依据设计方案和性质对其进行了大量的划分。</p>
<p>常见（kao）的锁</p>
<h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><p>Synchronized，它就是一个：非公平，悲观，独享，互斥，可重入，重量级</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Synchronized <span class="title">a</span> <span class="params">()</span></span>&#123;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">Synchronized <span class="title">b</span> <span class="params">()</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><p>以下两个锁都在JUC包下，是API层面上的实现</p>
<p>ReentrantLock，它是一个：默认非公平但可实现公平的，悲观，独享，互斥，可重入，重量级锁。</p>
<p>ReentrantReadWriteLocK，它是一个，默认非公平但可实现公平的，悲观，写独享，读共享，读写，可重入，重量级锁。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">lock .lock();</span><br><span class="line"> &#123;&#125;</span><br><span class="line">lock .unlock();</span><br></pre></td></tr></table></figure>

<p>公平锁：排队机制</p>
<p>AQS：百度</p>
<h4 id="ReentrantLock与synchronized-的区别"><a href="#ReentrantLock与synchronized-的区别" class="headerlink" title="ReentrantLock与synchronized 的区别"></a>ReentrantLock与synchronized 的区别</h4><p>ReentrantLock（可重入锁）</p>
<p>中断等待</p>
<p>ReentrantLock 拥有Synchronized相同的并发性和内存语义，此外还多了 锁投票，定时锁等候和中断锁等候。</p>
<p>线程A和B都要获取对象O的锁定，假设A获取了对象O锁，B将等待A释放对O的锁定</p>
<p>如果使用 synchronized ，如果A不释放，B将一直等下去，不能被中断</p>
<p>如果 使用ReentrantLock，如果A不释放，可以使B在等待了足够长的时间以后，中断等待，而干别的事情</p>
<h4 id="ReentrantLock获取锁定有三种方式"><a href="#ReentrantLock获取锁定有三种方式" class="headerlink" title="ReentrantLock获取锁定有三种方式"></a>ReentrantLock获取锁定有三种方式</h4><p>lock(),<br>如果获取了锁立即返回，如果别的线程持有锁， 当前线程则一直处于休眠状态，直到获取锁</p>
<p>tryLock(),<br>如果获取了锁立即返回true， 如果别的线程正持有锁，立即返回false</p>
<p>tryLock(long timeout,TimeUnit unit)<br>如果获取了锁定立即返回true， 如果别的线程正持有锁， 会等待参数给定的时间， 在等待的过程中，如果获取了锁定，就返回true， 如果等待超时，返回false；</p>
<p>lockInterruptibly:<br>如果获取了锁定立即返回， 如果没有获取锁定，当前线程处于休眠状态， 直到获取锁定，或者当前线程被别的线程中断</p>
<p>可实现公平锁<br>对于ReentrantLock而言， 通过构造函数指定该锁是否是公平锁， 默认是非公平锁。非公平锁的优点在于吞吐量比公平锁大。</p>
<p>锁绑定多个条件<br>锁绑定多个条件是指一个ReentrantLock对象可以同时绑定多个Condition对象，而在synchronized中，锁对象的wait（）和notify（）或notifyAll（）方法可以实现一个隐含的条件，如果要和多于一个的条件关联的时候，就不得不额外地添加一个锁，而ReentrantLock则无须这样做，只需要多次调用newCondition（）方法即可。</p>
<p>公平锁<br>AbstractQueuedSynchronizer</p>
<p>AQS；抽象的队列同步器；</p>
<p>所有抢锁的线程都去queue里面；</p>
<p>synchronized（也可重入）</p>
<p>优势<br>synchronized是在JVM层面上实现的， 不但可以通过一些监控工具监控synchronized的锁定， 而且在代码执行时出现异常，JVM会自动释放锁定， 但是使用Lock则不行，lock是通过代码实现的， 要保证锁定一定会被释放，就必须将unLock()放到finally{}中</p>
<p>场景<br>在资源竞争不是很激烈的情况下，Synchronized的性能要优于ReetrantLock， 但是在资源竞争很激烈的情况下，Synchronized的性能会下降几十倍，但是ReetrantLock的性能能维持常态； 实际上，我推荐大家以压力测试为准</p>
<p>按照性质分类</p>
<h4 id="公平锁-非公平锁"><a href="#公平锁-非公平锁" class="headerlink" title="公平锁/非公平锁"></a>公平锁/非公平锁</h4><p>公平锁:公平锁是指多个线程按照申请锁的顺序来获取锁。</p>
<p>非公平锁:非公平锁是指多个线程获取锁的顺序并不是按照申请锁的顺序， 有可能后申请的线程比先申请的线程优先获取锁。有可能，会造成优先级反转或者饥饿现象。</p>
<p>ReentrantLock而言，通过构造函数指定该锁是否是公平锁，默认是非公平锁</p>
<p>非公平锁的优点在于吞吐量比公平锁大。</p>
<p>对于Synchronized而言，也是一种非公平锁。</p>
<p>ReentrantLock是通过AQS的来实现线程调度，实现公平锁（AbstractQueuedSynchronizer）</p>
<h4 id="乐观锁-悲观锁"><a href="#乐观锁-悲观锁" class="headerlink" title="乐观锁/悲观锁"></a>乐观锁/悲观锁</h4><p>乐观锁与悲观锁不是指具体的什么类型的锁，而是指看待并发同步的角度</p>
<p>悲观锁<br>悲观锁认为对于同一个数据的并发操作， 一定是会发生修改的，哪怕没有修改，也会认为修改。 因此对于同一个数据的并发操作，悲观锁采取加锁的形式</p>
<p>悲观锁适合写操作非常多的场景</p>
<p>悲观锁在Java中的使用，就是利用各种锁。</p>
<p>乐观锁<br>乐观锁则认为对于同一个数据的并发操作，是不会发生修改的。 在更新数据的时候，会采用尝试更新，不断重新的方式更新数据。 乐观的认为，不加锁的并发操作是没有事情的</p>
<p>乐观锁适合读操作非常多的场景</p>
<p>不加锁会带来大量的性能提升</p>
<p>乐观锁在Java中的使用，是无锁编程，常常采用的是CAS算法， 典型的例子就是原子类，通过CAS自旋实现原子操作的更新。</p>
<p>CAS是英文单词CompareAndSwap的缩写，中文意思是：比较并替换。CAS需要有3个操作数：内存地址V，旧的预期值A，即将要更新的目标值B。</p>
<p>CAS指令执行时，当且仅当内存地址V的值与预期值A相等时，将内存地址V的值修改为B，否则就什么都不做。整个比较并替换的操作是一个原子操作。</p>
<h4 id="独享锁-共享锁"><a href="#独享锁-共享锁" class="headerlink" title="独享锁/共享锁"></a>独享锁/共享锁</h4><p>独享锁<br>独享锁是指该锁一次只能被一个线程所持有。</p>
<p>ReentrantLock是独享锁。</p>
<p>Synchronized是独享锁</p>
<p>共享锁<br>共享锁是指该锁可被多个线程所持有</p>
<p>ReentrantReadWriteLock，其读锁是共享锁，其写锁是独享锁。</p>
<p>读锁的共享锁可保证并发读是非常高效的，读写，写读 ，写写的过程是互斥的。独享锁与共享锁也是通过AQS来实现的， 通过实现不同的方法，来实现独享或者共享。</p>
<h4 id="互斥锁-读写锁"><a href="#互斥锁-读写锁" class="headerlink" title="互斥锁/读写锁"></a>互斥锁/读写锁</h4><p>独享锁/共享锁是一种广义的说法，互斥锁/读写锁就是具体的实现。</p>
<p>互斥锁</p>
<p>ReentrantLock</p>
<p>读写锁<br>读写锁在Java中的具体实现就是ReentrantReadWriteLock</p>
<p>可重入锁<br>可重入锁又名递归锁，是指在同一个线程在外层方法获取锁的时候，在进入内层加锁方法会自动获取锁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a()&#123;</span><br><span class="line"> <span class="keyword">if</span>(lock.lock())&#123;</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="comment">//  a(); 递归</span></span><br><span class="line"> <span class="comment">//while true；自旋</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReentrantLock、Synchronized都是可重入锁，可重入锁的一个好处是可一定程度避免死锁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> sychrnozied <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  xxxxxx;</span><br><span class="line">  test2();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> sychronized <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  yyyyy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 在上面代码段中，执行 test 方法需要获得当前对象作为监视器的对象锁，但方法中又调用了 test2 的同步方法。</p>
<p>如果锁是具有可重入性的话，那么该线程在调用 test2 时并不需要再次获得当前对象的锁，可以直接进入 test2 方法进行操作。</p>
<p>如果锁是不具有可重入性的话，那么该线程在调用 test2 前会等待当前对象锁的释放，实际上该对象锁已被当前线程所持有，不可能再次获得。</p>
<p>如果锁是不具有可重入性特点的话，那么线程在调用同步方法、含有锁的方法时就会产生死锁。</p>
<p>所以所有的锁都应该被设计成可重入的</p>
<hr>
<p><strong>按照设计分类</strong></p>
<h4 id="自旋锁-自适应自旋锁"><a href="#自旋锁-自适应自旋锁" class="headerlink" title="自旋锁/自适应自旋锁"></a>自旋锁/自适应自旋锁</h4><p>在Java中，自旋锁是指尝试获取锁的线程不会立即阻塞， 而是采用循环的方式去尝试获取锁，<strong>这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU。</strong> 非阻塞方式获取锁</p>
<p>自适应自旋</p>
<p>如果锁被占用的时间很短，自旋等待的效果就会非常好，反之，如果锁被占用的时间很长，那么自旋的线程只会白白消耗处理器资源，而不会做任何有用的工作，反而会带来性能上的浪费。</p>
<p>在JDK1.6中引入了自适应的自旋锁。</p>
<p>自旋的时间不固定，由前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定。</p>
<p>如果在同一个锁对象上，自旋等待刚刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也很有可能再次成功，进而它将允许自旋等待持续相对更长时间，比如100个循环。</p>
<p> 如果对于某个锁，自旋很少成功获得过，那在以后要获取这个锁时将可能省略掉自旋过程，以避免浪费处理器资源</p>
<p>什么是阻塞方式获取锁</p>
<p>阻塞指的是暂停一个线程的执行以等待某个条件发生（如某资源就绪）</p>
<p>sleep()：睡眠</p>
<p>Thread.sleep (long millis)方法，使线程转到阻塞状态。millis参数设定睡眠的时间，以毫秒为单位。当睡眠结束后，就转为就绪（Runnable）状态。</p>
<p>顺序进入同步块的，不释放锁，持有monitor对象锁，其他线程是不能进入的。//忍让一段时间 </p>
<p>阻塞而不释放锁</p>
<p>wait()：等待</p>
<p>wait() 与 notify/notifyAll()都是放在同步代码块中才能够执行的。</p>
<p>Object类中的wait()方法，导致当前的线程等待，直到其他线程调用此对象的 notify() 唤醒方法。这个两个唤醒方法也是Object类中的方法，行为等价于调用 wait() 一样。</p>
<p>wait() 和 notify() 方法：两个方法配套使用，<strong>wait()</strong> <strong>使得线程进入阻塞状态</strong>，它有两种形式，一种允许 <strong>指定以毫秒为单位的一段时间</strong>作为参数，<strong>另一种没有参数</strong>，<strong>前者</strong>当<strong>对应的 notify() 被调用</strong>或者<strong>超出指定时间</strong>时线程重新进入可执行状态，<strong>后者</strong>则必须<strong>对应的 notify()</strong> 被调用.</p>
<p><strong>当调用wait方法后，当前线程会释放持有的monitor对象锁</strong>，因此，其他线程还可以进入到同步方法，线程<strong>被唤醒后</strong>（如果加时间参数的话，则会在时间被消耗后唤醒，否则需要通过notify或notifyall唤醒），<strong>需要竞争锁</strong>，获取到锁之后再继续执行。//无条件忍让一段时间</p>
<p>阻塞并释放锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">(Object lock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;begin wait() ThreadName=&quot;</span></span><br><span class="line">                        + Thread.currentThread().getName());</span><br><span class="line">                lock.wait();</span><br><span class="line">                System.out.println(<span class="string">&quot;  end wait() ThreadName=&quot;</span></span><br><span class="line">                        + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synNotifyMethod</span><span class="params">(Object lock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;begin notify() ThreadName=&quot;</span></span><br><span class="line">                        + Thread.currentThread().getName() + <span class="string">&quot; time=&quot;</span></span><br><span class="line">                        + System.currentTimeMillis());</span><br><span class="line">                lock.notify();</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;  end notify() ThreadName=&quot;</span></span><br><span class="line">                        + Thread.currentThread().getName() + <span class="string">&quot; time=&quot;</span></span><br><span class="line">                        + System.currentTimeMillis());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">==================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object lock;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(Object lock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.lock = lock;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Service service = <span class="keyword">new</span> Service();</span><br><span class="line">        service.testMethod(lock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynNotifyMethodThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object lock;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SynNotifyMethodThread</span><span class="params">(Object lock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.lock = lock;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Service service = <span class="keyword">new</span> Service();</span><br><span class="line">        service.synNotifyMethod(lock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">==================</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"> </span><br><span class="line">        ThreadA a = <span class="keyword">new</span> ThreadA(lock);</span><br><span class="line">        a.start();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//NotifyThread notifyThread = new NotifyThread(lock);</span></span><br><span class="line">       <span class="comment">// notifyThread.start();</span></span><br><span class="line"> </span><br><span class="line">        SynNotifyMethodThread c = <span class="keyword">new</span> SynNotifyMethodThread(lock);</span><br><span class="line">        c.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> yield()：礼让</p>
<p>Thread.yield() 方法，暂停当前正在执行的线程对象，把执行机会让给相同或者更高优先级的线程。yield() 使得线程放弃当前分得的 CPU 时间，但是不使线程阻塞，即线程仍处于可执行状态，随时可能再次分得 CPU 时间。调用 yield() 的效果等价于调度程序认为该线程已执行了足够的时间从而转到另一个线程.</p>
<p> 放弃当前时间片，将Running状态转变为Runnable状态，不能指定多长时间。//假装忍让，完成具有不确定性不受监督的切换</p>
<p>暂停当前线程，主动让出自己的CPU时间</p>
<p>join()：插队</p>
<p>类似sleep，停止当前线程，让join线程先执行完毕，或执行指定的时间。//插队拼接</p>
<p>==main线程要等到t1线程运行结束后，才会输出“main end”。如果不加t1.join(),main线程和t1线程是并行的。而加上t1.join(),程序就变成是顺序执行了。==</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main start&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Worker(<span class="string">&quot;thread-1&quot;</span>));</span><br><span class="line">        t1.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;main end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">============================</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">==============线程是顺序执行的。=============================</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main start&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Worker(<span class="string">&quot;thread-1&quot;</span>));</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Worker(<span class="string">&quot;thread-2&quot;</span>));</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">//等待t1结束，这时候t2线程并未启动</span></span><br><span class="line">        t1.join();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//t1结束后，启动t2线程</span></span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="comment">//等待t2结束</span></span><br><span class="line">        t2.join();</span><br><span class="line"> </span><br><span class="line">        System.out.println(<span class="string">&quot;main end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当前线程等待join进来的执行完，再继续</p>
<p>suspend()和resume()：暂停/恢复</p>
<p>两个方法配套使用，suspend()使得线程进入阻塞状态，并且不会自动恢复，必须其对应的resume() 被调用，才能使得线程重新进入可执行状态。典型地，suspend() 和 resume() 被用在等待另一个线程产生的结果的情形：测试发现结果还没有产生后，让线程阻塞，另一个线程产生了结果后，调用 resume() 使其恢复。Thread中suspend()和resume()两个方法在JDK1.5中已经废除，不再介绍。因为有死锁倾向。</p>
<p>有死锁倾向</p>
<p>线程类常用方法</p>
<p>sleep(): 强迫一个线程睡眠Ｎ毫秒。</p>
<p>isAlive(): 判断一个线程是否存活。</p>
<p>join(): 等待线程终止。</p>
<p>activeCount(): 程序中活跃的线程数。</p>
<p>enumerate(): 枚举程序中的线程。</p>
<p>currentThread(): 得到当前线程。</p>
<p>isDaemon(): 一个线程是否为守护线程。</p>
<p>setDaemon(): 设置一个线程为守护线程。(用户线程和守护线程的区别在于，是否等待主线程依赖于主线程结束而结束)</p>
<p>setName(): 为线程设置一个名称。</p>
<p>wait(): 强迫一个线程等待。</p>
<p>notify(): 通知一个线程继续运行。</p>
<p>setPriority(): 设置一个线程的优先级。</p>
<h4 id="锁粗化-锁消除"><a href="#锁粗化-锁消除" class="headerlink" title="锁粗化/锁消除"></a>锁粗化/锁消除</h4><p>锁粗化和消除其实设计原理都差不多，都是为了减少没必要的加锁</p>
<p>锁消除<br>锁消除是指虚拟机即时编译器在运行时，对一些代码上要求同步，但是被检测到不可能存在共享数据竞争的锁进行消除。</p>
<p>锁消除的主要判定依据来源于逃逸分析的数据支持，如果判断在一段代码中，堆上的所有数据都不会逃逸出去从而被其他线程访问到，那就可以把它们当做栈上数据对待，认为它们是线程私有的，同步加锁自然就无须进行。 </p>
<p>锁粗化</p>
<p>如果一系列的连续操作都对同一个对象反复加锁和解锁，甚至加锁操作是出现在循环体中的，那即使没有线程竞争，频繁地进行互斥同步操作也会导致不必要的性能损耗。如果虚拟机探测到有这样一串零碎的操作都对同一个对象加锁，将会把加锁同步的范围扩展（粗化）到整个操作序列的外部</p>
<h4 id="偏向锁-轻量级锁-重量级锁"><a href="#偏向锁-轻量级锁-重量级锁" class="headerlink" title="偏向锁/轻量级锁/重量级锁"></a>偏向锁/轻量级锁/重量级锁</h4><p>这三种锁是指锁的状态，并且是针对Synchronized</p>
<p>偏向锁<br>偏向锁是指一段同步代码一直被一个线程所访问， 那么该线程会自动获取锁。降低获取锁的代价。</p>
<p>轻量级锁<br>是指当锁是偏向锁的时候，被另一个线程所访问， 偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，提高性能。</p>
<p>重量级锁<br>当锁为轻量级锁的时候，另一个线程虽然是自旋，但自旋不会一直持续下去， 当自旋一定次数的时候，还没有获取到锁，就会进入阻塞，该锁膨胀为重量级锁。 重量级锁会让其他申请的线程进入阻塞，性能降低。</p>
<p>分段锁<br>分段锁是一种锁的设计，并不是具体的一种锁</p>
<p>ConcurrentHashMap并发的实现就是通过分段锁的形式来实现高效的并发操作</p>
<p>ConcurrentHashMap中的分段锁称为Segment，它即类似于HashMap（JDK7与JDK8中HashMap的实现）的结构，即内部拥有一个Entry数组，数组中的每个元素又是一个链表；同时又是一个ReentrantLock（Segment继承了ReentrantLock)。</p>
<p>当需要put元素的时候，并不是对整个hashmap进行加锁，而是先通过hashcode来知道他要放在那一个分段中，然后对这个分段进行加锁，所以当多线程put的时候，只要不是放在一个分段中，就实现了真正的并行的插入。</p>
<p>但是，在统计size的时候，可就是获取hashmap全局信息的时候，就需要获取所有的分段锁才能统计。分段锁的设计目的是细化锁的粒度，当操作不需要更新整个数组的时候，就仅仅针对数组中的一项进行加锁操作。</p>
<p>分布式锁<br>Redisson</p>
<p>数据库锁<br><a target="_blank" rel="noopener" href="http://hedengcheng.com/?p=771#_Toc374698307">http://hedengcheng.com/?p=771#_Toc374698307</a></p>
<p>表锁、行锁、间隙锁、悲观锁、乐观锁、共享锁（读锁）、排他锁（写锁）</p>
<h1 id="8、分布式协调技术Zookeeper实现分布式锁"><a href="#8、分布式协调技术Zookeeper实现分布式锁" class="headerlink" title="8、分布式协调技术Zookeeper实现分布式锁"></a>8、分布式协调技术Zookeeper实现分布式锁</h1><h4 id="zookeeper实现过分布式锁吗？"><a href="#zookeeper实现过分布式锁吗？" class="headerlink" title="zookeeper实现过分布式锁吗？"></a>zookeeper实现过分布式锁吗？</h4><h4 id="分布式情况下，怎么解决订单号生成的重复问题？"><a href="#分布式情况下，怎么解决订单号生成的重复问题？" class="headerlink" title="分布式情况下，怎么解决订单号生成的重复问题？"></a>分布式情况下，怎么解决订单号生成的重复问题？</h4><p>问题产生</p>
<p>真分布式/伪分布式式</p>
<p>分布式优缺点</p>
<p>解决</p>
<p>1.使用分布式锁<br>    1、mysql数据库的乐观锁实现<br>    2、redis–redission<br>    3、zookeeper</p>
<p>2.提前生成好订单号，存放在内存取。获取订单号，直接从内存中取</p>
<p>实现思路</p>
<p>设计思想</p>
<blockquote>
<p>对于单进程的并发场景，我们可以使用synchronized关键字和Reentrantlock类等</p>
<p>对于分布式场景，我们可以使用分布式锁</p>
<p>创建锁<br>多个jvm服务器之间，同时在zookeeper上创建相同的一个临时节点，因为临时节点路径是保证唯一。<br>只要谁能够创建节点成功，谁就能够获取到锁<br>没有创建成功节点，只能注册个监听器监听这个锁并进行等待，当锁释放的时候，采用事件通知给其他客户端重新获取锁的资源，这时客户端使用事件监听，如果该临时节点被删除的话，重新进入获取锁的步骤</p>
<p>释放锁<br>Zookeeper使用直接关闭临时节点session会话连接，因为临时节点生命周期与session会话绑定在一起<br>如果session会话连续关闭的话，该临时节点也会被删除，这时候客户端使用事件监听，如果该临时节点被删除的话，重新进入到获取锁的步骤。</p>
</blockquote>
<hr>
<p>回顾我们的zookeeper临时节点的创建</p>
<p> zkClient端的事件监控通知demo</p>
<p>步骤方案</p>
<p>启动Linux系统下的zk服务器并设置好防火墙</p>
<p>pom</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- zookeeper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>log4j.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">log4j.appender.atguigu.File=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.atguigu.File.file=d:\\atguigu.log</span><br><span class="line">log4j.appender.atguigu.File.DatePattern=.yyyy-MM-dd</span><br><span class="line">log4j.appender.atguigu.File.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.atguigu.File.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %5p (%C:%M) - %m%n</span><br><span class="line"></span><br><span class="line">log4j.appender.atguigu.Console=org.apache.log4j.ConsoleAppender </span><br><span class="line">log4j.appender.atguigu.Console.layout=org.apache.log4j.PatternLayout    </span><br><span class="line">log4j.appender.atguigu.Console.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %5p (%C:%M) - %m%n </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log4j.rootLogger=error,atguigu.Console</span><br><span class="line"></span><br><span class="line">log4j.logger.com.atguigu=error</span><br></pre></td></tr></table></figure>

<p>模拟订单的工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hhf.distributed.lock.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: hhf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-05-10 22:18</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNumCreateUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrdNumber</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t 生产订单号:&quot;</span>+(++number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ZK接口ZKLock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hhf.distributed.lock.zk;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: hhf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-05-10 22:45</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ZkLock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zklock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zkUnlock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>模版模式抽象类ZkAbstractTemplateLock</p>
<p>模版模式</p>
<blockquote>
<p>在模板模式(Template Pattern)设计模式中，用一个抽象类公开定义了执行它的方法的方式、模板，它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。</p>
<p>意图:定义一个操作中的算法的骨架，将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p>主要解决:一些方法通用，却在每一个子类都重写了这一方法。</p>
<p>何时使用:有一些通用的方法</p>
<p>如何解决:将这些通用的算法抽象出来</p>
<p>关键代码:在抽象父类中实现通用的方法，其他步骤下放到子类中实现。</p>
<p>应用实例:</p>
<p>1、西游记中菩萨定好的81难就是一个顶层的逻辑骨架</p>
<p>2、spring中对Hibernate的支持，将一些已经定好的方法封装起来，比如开启事务、获取session、关闭session等，程序员不重复写那些已经规范好的代码，直接丢一个实体就可以保存。</p>
<p>优点:<br>1、封装不变部分，扩展可变部分。<br>2、提取公共代码，便于维护<br>3、行为由父类控制，子类实现</p>
<p>缺点:每一个不同的实现都需要一个子类来实现，导致类的个数增加，使得系统更加庞大。</p>
<p>使用场景:<br>1、有多个子类共用的方法，且逻辑相同<br>2、重要的、复杂的方法，可以考虑作为模板方法。</p>
</blockquote>
<p>ZkAbstractTemplateLock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hhf.distributed.lock.zk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.ZkClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: hhf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-05-10 22:50</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ZkAbstractTemplateLock</span> <span class="keyword">implements</span> <span class="title">ZkLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZKSERVER = <span class="string">&quot;localhost:2181&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer TIME_OUT = <span class="number">45</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> String path = <span class="string">&quot;/zklock0510&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> CountDownLatch countDownLatch = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    ZkClient zkClient = <span class="keyword">new</span> ZkClient(ZKSERVER,TIME_OUT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抢锁方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zklock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先看看有没有人已经用有锁了</span></span><br><span class="line">        <span class="keyword">if</span> (tryZkLock())&#123; <span class="comment">//如果返回true就说明没有人拥有锁</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t占用锁成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; <span class="comment">//如果抢不到锁，就等待</span></span><br><span class="line">            waitZkLock(); <span class="comment">//等待</span></span><br><span class="line">            zklock(); <span class="comment">//递归思想，若有人释放锁了，那么重新调用这个方法，去抢锁，</span></span><br><span class="line">             &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">waitZkLock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">tryZkLock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zkUnlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (zkClient != <span class="keyword">null</span>)&#123;</span><br><span class="line">            zkClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\t释放锁成功&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实现分布式锁的类ZkDistributedLock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hhf.distributed.lock.zk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.IZkDataListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: hhf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-05-10 23:17</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZkDistributedLock</span> <span class="keyword">extends</span> <span class="title">ZkAbstractTemplateLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">waitZkLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        IZkDataListener iZkDataListener = <span class="keyword">new</span> IZkDataListener() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *  监听的zk临时节点看看有没有改变</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> dataPath</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataChange</span><span class="params">(String dataPath, Object data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 看看监听的zk临时节点有没有被删除</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> datapath</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataDeleted</span><span class="params">(String datapath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (countDownLatch != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//zk的监听方法，监听zk的这个方法handleDataDeleted()有没有执行删除临时节点的方法,如果有就去抢锁</span></span><br><span class="line">        zkClient.subscribeDataChanges(path,iZkDataListener); <span class="comment">//如果没有抢到锁，就监听这个zk的这个临时节点的路径</span></span><br><span class="line">        <span class="keyword">if</span> (zkClient.exists(path))&#123;<span class="comment">//如果有这个节点了，就说明这个节点已被抢了</span></span><br><span class="line">            <span class="comment">//那么只能等待，不能往下执行，除非被占用的资源删掉了</span></span><br><span class="line">            countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);<span class="comment">//临时节点只有1个</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                countDownLatch.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            zkClient.unsubscribeDataChanges(path,iZkDataListener);<span class="comment">//解除对zk相应临时节点的监听</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryZkLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    zkClient.createEphemeral(path); <span class="comment">//在某个路径下面创建临时节点</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//创建成功返回true</span></span><br><span class="line">               &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">//创建失败返回false</span></span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>业务实现类OrderZkService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hhf.distributed.lock.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hhf.distributed.lock.util.OrderNumCreateUtil;</span><br><span class="line"><span class="keyword">import</span> com.hhf.distributed.lock.zk.ZkDistributedLock;</span><br><span class="line"><span class="keyword">import</span> com.hhf.distributed.lock.zk.ZkLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: hhf</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-05-10 22:25</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> OrderNumCreateUtil orderNumCreateUtil = <span class="keyword">new</span> OrderNumCreateUtil();</span><br><span class="line">    <span class="keyword">private</span> ZkLock zkLock = <span class="keyword">new</span> ZkDistributedLock(); <span class="comment">//手写的zk版的分布式锁</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getOrdNumber</span><span class="params">()</span></span>&#123;</span><br><span class="line">        zkLock.zklock();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;获得编号:-----&gt;:&quot;</span>+ orderNumCreateUtil.getOrdNumber()); <span class="comment">//线程值</span></span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                zkLock.zkUnlock();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终效果图</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105044784.png" alt="image-20210816105044784"></p>
<h1 id="9、SpringCloud-Alibaba系列"><a href="#9、SpringCloud-Alibaba系列" class="headerlink" title="9、SpringCloud Alibaba系列"></a>9、SpringCloud Alibaba系列</h1><h2 id="1-Nacos-spring-cloud-alibaba"><a href="#1-Nacos-spring-cloud-alibaba" class="headerlink" title="1. Nacos[spring cloud alibaba]"></a>1. Nacos[spring cloud alibaba]</h2><p><strong>简介</strong><br>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p>
<p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p>
<p><strong>文档</strong><br><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/what-is-nacos.html">https://nacos.io/zh-cn/docs/what-is-nacos.html</a></p>
<p><strong>安装</strong><br><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/quick-start.html">https://nacos.io/zh-cn/docs/quick-start.html</a></p>
<p>1、windows</p>
<p>2、linux</p>
<p>3、docker化</p>
<p><strong>使用</strong></p>
<p>1、核心概念</p>
<p>namespace**(命名空间)**</p>
<p>namespace 的设计是 nacos 基于此做<strong>多环境</strong>以及<strong>多租户数据</strong>(配置和服务)<strong>隔离</strong>的</p>
<p>  从一个租户(用户)的角度来看，如果有多套不同的环境，那么这个时候可以根据指定的环境来创建不同的 namespce，以此来实现多环境的隔离。例如，你可能有日常，预发和生产三个不同的环境，那么使用一套 nacos 集群可以分别建以下三个不同的 namespace。如下图所示：</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105114310.png" alt="image-20210816105114310"></p>
<p>从多个租户(用户)的角度来看，每个租户(用户)可能会有自己的 namespace,每个租户(用户)的配置数据以及注册的服务数据都会归属到自己的 namespace 下，以此来实现多租户间的数据隔离。例如超级管理员分配了三个租户，分别为张三、李四和王五。分配好了之后，各租户用自己的账户名和密码登录后，创建自己的命名空间。如下图所示：</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105128914.png" alt="image-20210816105128914"></p>
<p> 注意: 该功能还在规划中。</p>
<p>用于进行租户粒度的配置隔离。不同的命名空间下，可以存在相同的 Group 或 Data ID 的配置。Namespace 的常用场景之一是不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源（如配置、服务）隔离等。</p>
<p>配置<br>在系统开发过程中，开发者通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。目的是让静态的系统工件或者交付物（如 WAR，JAR 包等）更好地和实际的物理运行环境进行适配。配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成。配置变更是调整系统运行时的行为的有效手段。</p>
<p>配置管理<br>系统配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动。</p>
<p>配置项<br> 一个具体的可配置的参数与其值域，通常以 param-key=param-value 的形式存在。例如我们常配置系统的日志输出级别（logLevel=INFO|WARN|ERROR） 就是一个配置项。</p>
<p>配置集<br>一组相关或者不相关的配置项的集合称为配置集。在系统中，一个配置文件通常就是一个配置集，包含了系统各个方面的配置。例如，一个配置集可能包含了数据源、线程池、日志级别等配置项。</p>
<p>配置集 ID**(data-id)**<br>Nacos 中的某个配置集的 ID。配置集 ID 是组织划分配置的维度之一。Data ID 通常用于组织划分系统的配置集。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。Data ID 通常采用类 Java 包（如 com.taobao.tc.refund.log.level）的命名规则保证全局唯一性。此命名规则非强制。</p>
<p>配置分组<br>Nacos 中的一组配置集，是组织配置的维度之一。通过一个有意义的字符串（如 Buy 或 Trade ）对配置集进行分组，从而区分 Data ID 相同的配置集。当您在 Nacos 上创建一个配置时，如果未填写配置分组的名称，则配置分组的名称默认采用 DEFAULT_GROUP 。配置分组的常见场景：不同的应用或组件使用了相同的配置类型，如 database_url 配置和 MQ_topic 配置。</p>
<p>endpoint<br>当 nacos server 集群需要扩缩容时，客户端需要有一种能力能够及时感知到集群发生变化。及时感知到集群的变化是通过 endpoint来实现的。也即客户端会定时的向endpoint发送请求来更新客户端内存中的集群列表。</p>
<p>其他查看官方文档</p>
<p>2、nacos-discovery服务注册、发现</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816105156172.png" alt="image-20210816105156172"></p>
<ol>
<li><p>创建provider应用（cloud选择ribbon，一会儿要测试调用）</p>
</li>
<li><p>引入nacos-discovery</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;nacos.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">&lt;--!注意:版本0.2xReLEASE对应的是spring boot2.x 版本，0.1.x对应的是springboot1.x--&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改application.properties</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8070</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-provider #指定应用名字</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848  #指定nacos地址</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启用服务注册发现功能</li>
</ol>
<p><code>@EnableDiscoveryClient</code></p>
<ol start="5">
<li><p>在nacos控制台查看注册的服务</p>
</li>
<li><p>创建consumer应用（cloud选择ribbon，测试调用）</p>
<pre><code>1、引入nacos-discovery依赖
2、修改application.properties指定nacos地址
3、启用服务注册发现
4、利用ribbon测试远程调用
</code></pre>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/echo/&#123;str&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(<span class="meta">@PathVariable</span> String str)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> restTemplate.getForObject(<span class="string">&quot;http://service-provider/echo/&quot;</span> + str, String.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>3、nacos-config配置管理（配置的动态变更）</p>
<p>·     1、引入nacos-config</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;nacos.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816142715502.png" alt="image-20210816142715502"></p>
<p>·     2、创建bootstrap.properties文件，指定nacos配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">xxxxxx</span></span><br></pre></td></tr></table></figure>

<p>·     3、我们需要了解的默认规则</p>
<p>之所以需要配置 spring.application.name ，是因为它是构成 Nacos 配置管理 dataId字段的一部分。</p>
<p>在 Nacos Spring Cloud 中，dataId 的完整格式如下：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure>

<p>  prefix 默认为 spring.application.name 的值，也可以通过配置项 spring.cloud.nacos.config.prefix来配置。</p>
<p>  spring.profile.active 即为当前环境对应的 profile，详情可以参考 Spring Boot文档。 注意：当 spring.profile.active 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 ${prefix}.${file-extension}</p>
<p>  file-exetension 为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置。目前只支持 properties 和 yaml 类型。</p>
<p>·     1、spring.application.name很重要 ，是因为它是构成 Nacos 配置管理 dataId字段的一部分。</p>
<p>·     2、dataId 的完整格式 ${prefix}-${spring.profile.active}.${file-extension}</p>
<p>·     prefix</p>
<p>·      默认为 spring.application.name 的值，也可以通过配置项 spring.cloud.nacos.config.prefix来配置。</p>
<p>·     spring.profile.active</p>
<p>·     当前环境对应的 profile。当 spring.profile.active 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 ${prefix}.${file-extension}</p>
<p>·     file-exetension</p>
<p>·     为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置。目前只支持 properties 和 yaml 类型。</p>
<p>·     4、通过 Spring Cloud 原生注解 @RefreshScope 实现配置自动更新：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/config&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;useLocalCache:false&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> useLocalCache;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> useLocalCache;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     5、修改配置文件，查看是否实时变更</p>
<p>·     6、高级：nacos，指定namespace&amp;多data-id加载</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring.application.name=gulimall-pms</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#spring.application.name=multi-data-ids-example</span></span><br><span class="line"><span class="comment">#spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0.2.1.RELEASE 以上支持多个配置，文档：https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/Nacos-config</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos 控制台添加配置：</span></span><br><span class="line"><span class="comment">#   Data ID：app.properties</span></span><br><span class="line"><span class="comment">#   Group：multi-data-ids</span></span><br><span class="line"><span class="comment">#   配置内容：app.user.cache=false</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.namespace=ef1c9ca2-40d7-4eb6-ad7f-c12c5751c193</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[0].data-id=app.properties</span></span><br><span class="line"><span class="comment">#spring.cloud.nacos.config.ext-config[0].group=multi-data-ids</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[0].refresh=true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 本地安装 MySQL</span></span><br><span class="line"><span class="comment"># 2. Nacos 控制台添加配置：</span></span><br><span class="line"><span class="comment">#   Data ID：datasource.properties</span></span><br><span class="line"><span class="comment">#   Group：multi-data-ids</span></span><br><span class="line"><span class="comment">#   配置内容示例：</span></span><br><span class="line"><span class="comment">#       spring.datasource.url=jdbc:mysql://localhost:3306/test?useSSL=false</span></span><br><span class="line"><span class="comment">#       spring.datasource.username=root</span></span><br><span class="line"><span class="comment">#       spring.datasource.password=root</span></span><br><span class="line"><span class="comment">#       spring.datasource.initial-size=10</span></span><br><span class="line"><span class="comment">#       spring.datasource.max-active=20</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[1].data-id=datasource.properties</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[1].refresh=true</span></span><br><span class="line"><span class="comment">#spring.cloud.nacos.config.ext-config[1].group=multi-data-ids</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 本地安装 Redis</span></span><br><span class="line"><span class="comment"># 2. Nacos 控制台添加配置：</span></span><br><span class="line"><span class="comment">#   Data ID：redis.properties</span></span><br><span class="line"><span class="comment">#   Group：multi-data-ids</span></span><br><span class="line"><span class="comment">#   配置内容示例：</span></span><br><span class="line"><span class="comment">#       spring.redis.host=localhost</span></span><br><span class="line"><span class="comment">#       spring.redis.password=20190101</span></span><br><span class="line"><span class="comment">#       spring.redis.timeout=5000</span></span><br><span class="line"><span class="comment">#       spring.redis.max-idle=5</span></span><br><span class="line"><span class="comment">#       spring.redis.max-active=10</span></span><br><span class="line"><span class="comment">#       spring.redis.max-wait=3000</span></span><br><span class="line"><span class="comment">#       spring.redis.test-on-borrow=false</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[2].data-id=redis.properties</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[2].refresh=true</span></span><br><span class="line"><span class="comment">#spring.cloud.nacos.config.ext-config[2].group=multi-data-ids</span></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     7、当一个配置在本地文件和nacos中都有时，优先使用nacos的，如果nacos中娶不到值，则用本地配置的</p>
<h2 id="2-SpringCloud-Gateway"><a href="#2-SpringCloud-Gateway" class="headerlink" title="2. SpringCloud Gateway"></a>2. SpringCloud Gateway</h2><p>简介</p>
<p>Spring Cloud Gateway旨在提供一种简单而有效的方式来对API进行路由，并为他们提供切面，例如：安全性，监控/指标 和弹性等。</p>
<p><strong>为什么使用API 网关？</strong></p>
<p>API 网关出现的原因是微服务架构的出现，不同的微服务一般会有不同的网络地址，而外部客户端可能需要调用多个服务的接口才能完成一个业务需求，如果让客户端直接与各个微服务通信，会有以下的问题：</p>
<p>客户端会多次请求不同的微服务，增加了客户端的复杂性。<br>存在跨域请求，在一定场景下处理相对复杂。<br>认证复杂，每个服务都需要独立认证。<br>难以重构，随着项目的迭代，可能需要重新划分微服务。例如，可能将多个服务合并成一个或者将一个服务拆分成多个。如果客户端直接与微服务通信，那么重构将会很难实施。<br>某些微服务可能使用了防火墙 / 浏览器不友好的协议，直接访问会有一定的困难。</p>
<p>以上这些问题可以借助 API 网关解决。API 网关是介于客户端和服务器端之间的中间层，所有的外部请求都会先经过 API 网关这一层。也就是说，API 的实现方面更多的考虑业务逻辑，而安全、性能、监控可以交由 API 网关来做，这样既提高业务灵活性又不缺安全性： </p>
<p><strong>使用 API 网关后的优点如下：</strong></p>
<p>易于监控。可以在网关收集监控数据并将其推送到外部系统进行分析。</p>
<p>易于认证。可以在网关上进行认证，然后再将请求转发到后端的微服务，而无须在每个微服务中进行认证。</p>
<p>减少了客户端与各个微服务之间的交互次数。</p>
<p><strong>API</strong> <strong>网关选型：</strong></p>
<p>业界情况</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816142833509.png" alt="image-20210816142833509"></p>
<p>gateway性能高于zuul，在高吞吐量，高并发情况下表现很好。</p>
<p>注意</p>
<p>Spring Cloud Gateway依赖Spring Boot和Spring Webflux提供的Netty runtime。它不能在传统的Servlet容器中工作或构建为WAR</p>
<p>Webflux:    <a target="_blank" rel="noopener" href="https://blog.51cto.com/liukang/2090163">https://blog.51cto.com/liukang/2090163</a></p>
<p>特性</p>
<p>基于Spring 5，Reactor 和 Spring Boot 2.0</p>
<ol>
<li><p>能够在任何请求属性上匹配路由</p>
</li>
<li><p>断言和过滤器是特定于路由的</p>
</li>
<li><p>Hystrix断路器集成</p>
</li>
<li><p>Spring Cloud DiscoveryClient集成</p>
</li>
<li><p>易于编写断言和过滤器</p>
</li>
<li><p>请求速率限制</p>
</li>
<li><p>路径重写</p>
</li>
</ol>
<p>文档</p>
<p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#_cors_configuration">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#_cors_configuration</a></p>
<p>概念</p>
<p>Route 路由</p>
<p>gateway的基本构建模块。它由ID、目标URI、断言集合和过滤器集合组成。如果聚合断言结果为真，则匹配到该路由。</p>
<p>Predicate 断言</p>
<p>这是一个Java 8 Function Predicate。输入类型是 Spring Framework ServerWebExchange。这允许开发人员可以匹配来自HTTP请求的任何内容，例如Header或参数。</p>
<p>Filter 过滤器</p>
<p>这些是使用特定工厂构建的 Spring FrameworkGatewayFilter实例。所以可以在返回请求之前或之后修改请求和响应的内容。</p>
<p>入门示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemogatewayApplication</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customRouteLocator</span><span class="params">(RouteLocatorBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">            .route(<span class="string">&quot;path_route&quot;</span>, r -&gt; r.path(<span class="string">&quot;/get&quot;</span>)</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .route(<span class="string">&quot;host_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.myhost.org&quot;</span>)</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .route(<span class="string">&quot;rewrite_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.rewrite.org&quot;</span>)</span><br><span class="line">                .filters(f -&gt; f.rewritePath(<span class="string">&quot;/foo/(?&lt;segment&gt;.*)&quot;</span>, <span class="string">&quot;/$&#123;segment&#125;&quot;</span>))</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .route(<span class="string">&quot;hystrix_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.hystrix.org&quot;</span>)</span><br><span class="line">                .filters(f -&gt; f.hystrix(c -&gt; c.setName(<span class="string">&quot;slowcmd&quot;</span>)))</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .route(<span class="string">&quot;hystrix_fallback_route&quot;</span>, r -&gt; r.host(<span class="string">&quot;*.hystrixfallback.org&quot;</span>)</span><br><span class="line">                .filters(f -&gt; f.hystrix(c -&gt; c.setName(<span class="string">&quot;slowcmd&quot;</span>).setFallbackUri(<span class="string">&quot;forward:/hystrixfallback&quot;</span>)))</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .route(<span class="string">&quot;limit_route&quot;</span>, r -&gt; r</span><br><span class="line">                .host(<span class="string">&quot;*.limited.org&quot;</span>).and().path(<span class="string">&quot;/anything/**&quot;</span>)</span><br><span class="line">                .filters(f -&gt; f.requestRateLimiter(c -&gt; c.setRateLimiter(redisRateLimiter())))</span><br><span class="line">                .uri(<span class="string">&quot;http://httpbin.org&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>核心</p>
<p>Predicate 断言</p>
<p>·     RoutePredicateFactory</p>
<p>Filter 过滤器</p>
<p>·     GatewayFilterFactory</p>
<p>·     GlobalFilter</p>
<p>应用</p>
<p>1、网关项目的pom</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>gulimall-gateway<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>谷粒商城网关<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、整合各个项目的统一swagger接口（后来做）</p>
<p>·     GulimallSwaggerResourceProvider</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.gateway.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.TypeReference;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.SwaggerResource;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.SwaggerResourcesProvider;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallSwaggerResourceProvider</span> <span class="keyword">implements</span> <span class="title">SwaggerResourcesProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * swagger2默认的url后缀</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SWAGGER2RESOURCESURL = <span class="string">&quot;/swagger-resources&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    private static final String SWAGGER2URL = &quot;/v2/api-docs&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 网关路由</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RouteLocator routeLocator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 网关应用名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.application.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String self;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GulimallSwaggerResourceProvider</span><span class="params">(RouteLocator routeLocator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.routeLocator = routeLocator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SwaggerResource&gt; <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;SwaggerResource&gt; resources = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; routeHosts = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 由于我的网关采用的是负载均衡的方式，因此我需要拿到所有应用的serviceId</span></span><br><span class="line">        <span class="comment">// 获取所有可用的host：serviceId</span></span><br><span class="line">        routeLocator.getRoutes().filter(route -&gt; route.getUri().getHost() != <span class="keyword">null</span>)</span><br><span class="line">                .filter(route -&gt; !self.equals(route.getUri().getHost()))</span><br><span class="line">                .subscribe(route -&gt; routeHosts.add(route.getUri().getHost()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录已经添加过的server，存在同一个应用注册了多个服务在nacos上</span></span><br><span class="line">        Set&lt;String&gt; dealed = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        routeHosts.forEach(instance -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//String url = &quot;/&quot; + instance + SWAGGER2URL;</span></span><br><span class="line">            String url = <span class="string">&quot;http://&quot;</span>+instance+<span class="string">&quot;/&quot;</span>+SWAGGER2RESOURCESURL;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!dealed.contains(url)) &#123;</span><br><span class="line">                dealed.add(url);</span><br><span class="line">                String forObject = restTemplate.getForObject(url, String.class);</span><br><span class="line">                List&lt;Map&lt;String, String&gt;&gt; list = JSON.parseObject(forObject, <span class="keyword">new</span> TypeReference&lt;List&lt;Map&lt;String, String&gt;&gt;&gt;() &#123;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">//要获取每个swagger-resource从而得出真正的v2/docs；所以加上ribbon；</span></span><br><span class="line">                SwaggerResource swaggerResource = <span class="keyword">new</span> SwaggerResource();</span><br><span class="line">                <span class="comment">// 拼接url，样式为/serviceId/v2/api-info，当网关调用这个接口时，网关就需要配置路由，则会自动通过负载均衡寻找对应的主机</span></span><br><span class="line">                <span class="comment">//有编码问题；</span></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">                    swaggerResource.setUrl(<span class="string">&quot;/&quot;</span>+instance+list.get(<span class="number">0</span>).get(<span class="string">&quot;url&quot;</span>));</span><br><span class="line">                    swaggerResource.setName(list.get(<span class="number">0</span>).get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                    swaggerResource.setSwaggerVersion(list.get(<span class="number">0</span>).get(<span class="string">&quot;swaggerVersion&quot;</span>));</span><br><span class="line">                    resources.add(swaggerResource);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> resources;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SwaggerResourceController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.gateway.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger.web.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * gateway整合swagger的核心</span></span><br><span class="line"><span class="comment"> * 1）、每一个微服务/swagger-resources;都可以获取自己微服务的swagger信息</span></span><br><span class="line"><span class="comment"> * [</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *         &quot;name&quot;: &quot;商品平台&quot;,</span></span><br><span class="line"><span class="comment"> *         &quot;url&quot;: &quot;/v2/api-docs?group=商品平台&quot;,[这个很重要]</span></span><br><span class="line"><span class="comment"> *         &quot;swaggerVersion&quot;: &quot;2.0&quot;,</span></span><br><span class="line"><span class="comment"> *         &quot;location&quot;: &quot;/v2/api-docs?group=商品平台&quot;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> * 2）、我们通过网关，发现出所有上线的微服务以及他们的/swagger-resources，获取到每个微服务的swagger的url</span></span><br><span class="line"><span class="comment"> * 3）、给每一个微服务发送刚才url( /v2/api-docs?group=商品平台)就可以获取到服务的swagger接口文档信息</span></span><br><span class="line"><span class="comment"> * 4）、GulimallSwaggerResourceProvider可以帮我们</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/swagger-resources&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerResourceController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GulimallSwaggerResourceProvider swaggerResourceProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SwaggerResourceController</span><span class="params">(GulimallSwaggerResourceProvider swaggerResourceProvider)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.swaggerResourceProvider = swaggerResourceProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/configuration/security&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;SecurityConfiguration&gt; <span class="title">securityConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(SecurityConfigurationBuilder.builder().build(), HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/configuration/ui&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;UiConfiguration&gt; <span class="title">uiConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(UiConfigurationBuilder.builder().build(), HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;SwaggerResource&gt;&gt; swaggerResources() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(swaggerResourceProvider.get(), HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、路由各个请求到相应的服务配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line"><span class="comment">#         =======pms====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pms_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-pms</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/pms/**,/gulimall-pms/**</span></span><br><span class="line"><span class="comment">#            - Path=/gulimall-pms/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-pms/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#        =======oms====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">oms_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-oms</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/oms/**,/gulimall-oms/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-oms/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#        =======sms====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">sms_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-sms</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/sms/**,/gulimall-sms/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-sms/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"><span class="comment">#        =======tms====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">tms_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-tms</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/tms/**,/gulimall-tms/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-tms/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"><span class="comment">#        ======ums=====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">ums_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-ums</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/ums/**,/gulimall-ums/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-ums/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"><span class="comment">#        ======wms====</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">wms_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-wms</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/wms/**,/gulimall-wms/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/gulimall-wms/(?&lt;segment&gt;.*),</span> <span class="string">/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">88</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、整合Hystrix进行容错</p>
<p>·     0、导入Hystrix依赖，并开启断路保护@EnableHystrix或者@EnableCircuitBreaker</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     1、Gateway配置各个微服务服务容错</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">hystrix_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://backing-service:8088</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/consumingserviceendpoint</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hystrix</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">fallbackcmd</span></span><br><span class="line">            <span class="attr">fallbackUri:</span> <span class="string">forward:/incaseoffailureusethis</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     2、Gateway配置全局容错</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hystrix</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">fallbackcmd</span></span><br><span class="line">            <span class="attr">fallbackUri:</span> <span class="string">forward:/incaseoffailureusethis</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在gateway中写一个controller。来映射incaseoffailureusethis即可</p>
<h2 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h2><h4 id="3-你是怎么解决分布式事务？"><a href="#3-你是怎么解决分布式事务？" class="headerlink" title="3.你是怎么解决分布式事务？"></a>3.你是怎么解决分布式事务？</h4><p>答：我是用SpringCloudAlibaba开源的Seata</p>
<h4 id="4-那请你说说你对Seata的理解？"><a href="#4-那请你说说你对Seata的理解？" class="headerlink" title="4.那请你说说你对Seata的理解？"></a>4.那请你说说你对Seata的理解？</h4><p>答：seata它是由1+3的套件所组成，所谓的1+3的1就是全局唯一事务的id，只要在同一ID下不管几个库，都能证明是一套的全局下面的统一体，3就是3大组件，主要是指TC，TM，RM三个概念。</p>
<h4 id="5-那TC，TM，RM是怎么协作的？"><a href="#5-那TC，TM，RM是怎么协作的？" class="headerlink" title="5.那TC，TM，RM是怎么协作的？"></a>5.那TC，TM，RM是怎么协作的？</h4><p>答:请你谈谈什么是服务的降级，服务的熔断，服务的限流？</p>
<h4 id="6-SpringCloud-Alibaba和Spring团队研发的SpringCloud有什么区别？"><a href="#6-SpringCloud-Alibaba和Spring团队研发的SpringCloud有什么区别？" class="headerlink" title="6.SpringCloud Alibaba和Spring团队研发的SpringCloud有什么区别？"></a>6.SpringCloud Alibaba和Spring团队研发的SpringCloud有什么区别？</h4><p>答：SpringCloud原生的很多组件已经不维护了，而springcloudalibaba是借鉴了原生的springcloud技术，开发出的新产品。而且更加的方便易用，springcloudalibaba已能提供微服务治理的整套解决方案并经过了双十一的验证</p>
<h4 id="7-SpringCloud和SpringBoot的区别和关系？"><a href="#7-SpringCloud和SpringBoot的区别和关系？" class="headerlink" title="7.SpringCloud和SpringBoot的区别和关系？"></a>7.SpringCloud和SpringBoot的区别和关系？</h4><p>SpringBoot专注于快速，方便的开发单个微服务个体，SpringCloud关注全局的服务治理框架。</p>
<h4 id="什么是服务的熔断？"><a href="#什么是服务的熔断？" class="headerlink" title="什么是服务的熔断？"></a>什么是服务的熔断？</h4><p>熔断机制是应对雪崩效应的一种微服务链路保护机制。</p>
<p>当扇出链路的某个微服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回”错误”的响应信息。当检测到该节点微服务调用响应正常后恢复调用链路。在SpringCloud框架里熔断机制通过Hystrix实现。Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是5秒内20次调用失败就会启动熔断机制。熔断机制的注解是@HystrixCommand。</p>
<h4 id="什么是服务的降级？"><a href="#什么是服务的降级？" class="headerlink" title="什么是服务的降级？"></a>什么是服务的降级？</h4><p>整体资源快不够了，忍痛将某些服务先关掉，待渡过难关，再开启回来。</p>
<p>服务降级处理是在客户端实现完成的，与服务端没有关系。</p>
<p>熔断和降级的区别：</p>
<blockquote>
<p>服务熔断<br>一般是指某个服务故障或者异常引起，类似现实世界中的”保险丝”，当某个异常条件被触发，直接熔断整个服务，而不是一直等到此服务超时</p>
<p>服务降级<br>所谓降级，一般是从整体负荷考虑，就是当某个服务熔断后，服务器将不再被调用，此时客户端可以自己准备一个本地的fallback回调，返回一个缺省值。<br>这样做，虽然整体服务水平下降，但是好歹可用，比直接挂掉要强。 </p>
</blockquote>
<h1 id="10、本地事务-amp-amp-分布式事务"><a href="#10、本地事务-amp-amp-分布式事务" class="headerlink" title="10、本地事务&amp;&amp;分布式事务"></a>10、本地事务&amp;&amp;分布式事务</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="本地事务"><a href="#本地事务" class="headerlink" title="本地事务"></a>本地事务</h3><p>1.本地事务的简介</p>
<p>本地事务是在单个数据源上进行数据的访问和更新等操作的</p>
<p>2.ACID的特性</p>
<p>·     ACID</p>
<p>原子性（Atomicity）,一致性(Consistency),隔离性或者独立性(Isolation)和持久性(Durabilily)。简称就是:ACID</p>
<p>原子性（Atomicity）：一系列的操作整体不可拆分，要么同时成功，要么同时失败。</p>
<p>一致性(Consistency)：数据在事务的前后，业务整体一致。</p>
<p>隔离性或者独立性(Isolation)：事务之间是互相隔离的。</p>
<p>持久性(Durabilily)：一旦事务成功，数据一定会落盘在数据库中。</p>
<p>3.事务的传播行为</p>
<p>Propagation propagation() default </p>
<p>Propagation是事务的传播行为:  其意思就是： 当事务里面还有其他事务方法的时候，其他事务方法就有以下这么多种可能来运行。</p>
<ol>
<li><p>REQUIRED【无论如何这个方法都必须在事务内运行】： 需要一个事物，如果外层已经存在了事务。就用已经存在的事务，否则就创建一个事务</p>
</li>
<li><p>REQUIRES_NEW【总是需要创建新的事务】：无论外层有没有存在事务，都自己创建一个事务，在自己的事物内进行运行。</p>
</li>
</ol>
<p>《以上两个是最常用》</p>
<ol start="3">
<li><p>SUPPORTS【支持事务】：如果外层有事务，就在该事务内运行，否则就可以不以事务的方式运行。</p>
</li>
<li><p>MANDATORY【强制运行在已经存在的事务内】： 必须在事务内运行，如果外层已存在事务，就在这个事务内运行，如果外层没有事务，就将抛出异常。</p>
</li>
<li><p>NOT_SUPPORTED【不支持运行在事务内】： 必须以非事务的方式运行。如果外层已经有事务了，就把外层的事务暂停。</p>
</li>
<li><p>NEVER【必须以非事务方式运行】： 如果外层有事务，就会抛出异常，否则就会正常运行。</p>
</li>
<li><p>NESTED【嵌入式的事务】： 基于存档点的事物</p>
</li>
</ol>
<p>4.事务的隔离级别</p>
<p>隔离级别产生的原因：是因为数据库同时存在即读又写，所以得防止在写的过程中，读这条数据是要读到，还是怎么去读，隔离级别就是为了保证同时对一个数据进行读写该要怎么处理。</p>
<p>读未提交【read uncommitted】（可以读到没有提交的数据）</p>
<p>读已提交【read committed】（只能读到提交了的数据） Oracle数据库默认的隔离级别</p>
<p>可重复读【Repeatable read】（同一个事务内，之前读到的数据是多少，以后还是多少，只要事物不结束的情况下） Mysql数据库默认的隔离级别</p>
<p>串行化【Serializable】（已经不用）</p>
<p>以上不同隔离级别可能会导致以下现象</p>
<p>·     1.脏读：若把隔离级别调为读未提交，那么读到没有生效的数据（读未提交）就会发生脏读，这是不允许发生的</p>
<p>·     2.幻读：同一个事物内下次读到的和上次读到的不一样（读未提交，读已提交）是允许发生的</p>
<p>·     3.可重复读：可重复多次读取数据，多次读取到的都一样，就不会有幻读的问题</p>
<p>·     4.不可重复读：不能多次重复读取数据，多次读取会读到不一样的，这会有幻读的问题。</p>
<p>5.事务的回滚策略</p>
<p>rollbackFor：指定的异常必须回滚</p>
<p>noRollbackFor：发生指定的异常不用回滚</p>
<p>异常<br>运行时异常（不受检查异常，没有强制要求try-catch的）：都会回滚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ArrayOutofIndex</span><br><span class="line">Math...</span><br><span class="line">OutofMemory</span><br><span class="line">NullPointException</span><br><span class="line">编译异常（受检查异常）【必须进行处理，要么try-catch要么throws】的：都不回滚</span><br><span class="line">FileNotFoundException</span><br></pre></td></tr></table></figure>

<p>6.SpringBoot本地事务之大坑</p>
<p>SpringBoot在做事务的时候，在某些情况下有可能会不起作用，特别是使用@Transactional(propagation = Propagation.REQUIRES_NEW)的隔离级别的时候，有可能不起事务的作用。</p>
<p>因为 @Transactional的底层是AOP，那么事务想要生效必须是使用代理对象来调用才行： 如果你的业务代码中，有使用事务的隔离级别，尽量不要使用this来调用,防止事务的失效。</p>
<p>因为this并不是代理对象，就相当于代码粘到了大方法里面，this.方法（）是跟外层用的同一个事务，所以事务失效了。</p>
<p>解决方案：开启AOP来进行代理，导入aop-starter，暴露代理对象来解决</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.开启自动代理:@EnableAspectJAutoProxy</span><br><span class="line">2.暴露代理对象：@EnableAspectJAutoProxy(exposeProxy=true)</span><br><span class="line">3.获取代理对象：AopContext.getCurrent()</span><br></pre></td></tr></table></figure>

<h3 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h3><p>7.什么是分布式事务</p>
<p>分布式事务指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。</p>
<p>简单的说，就是一次大的操作由不同的小操作组成，这些小的操作分布在不同的服务器上，且属于不同的应用，分布式事务需要保证这些小操作要么全部成功，要么全部失败。</p>
<p>本质上来说，分布式事务就是为了保证不同数据库的数据一致性。</p>
<p>分布式系统经常出现的异常如：</p>
<p>机器宕机，网络异常，消息丢失，消息乱序，数据错误，不可靠的TCP，存储数据丢失等问题。</p>
<p>8.BASE【柔性的事务： 最终一致，基本可用，软状态】</p>
<p>·     分布式事务的相关解决方案</p>
<p>·     基于XA协议的两阶段提交</p>
<p>数据库支持的2PC【2 phase commit】，又叫做 XA Transactions。</p>
<p>MySQL从5.5版本开始支持，SQL Server 2005 开始支持，Oracle 7 开始支持。</p>
<p>其中，XA 是一个两阶段提交协议，该协议分为以下两个阶段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一阶段：事务协调器要求每个涉及到事务的数据库预提交(precommit)此操作，并反映是否可以提交.</span><br><span class="line">第二阶段：事务协调器要求每个数据库提交数据。</span><br><span class="line">其中，如果有任何一个数据库否决此次提交，那么所有数据库都会被要求回滚它们在此事务中的那部分信息。</span><br><span class="line">可用率 a%*b% = 99%*99%=98%</span><br></pre></td></tr></table></figure>

<p>总的来说，XA协议比较简单，而且一旦商业数据库实现了XA协议，使用分布式事务的成本也比较低。但是，XA也有致命的缺点，那就是性能不理想，特别是在交易下单链路，往往并发量很高，XA无法满足高并发场景。XA目前在商业数据库支持的比较理想，在mysql数据库中支持的不太理想，mysql的XA实现，没有记录prepare阶段日志，主备切换回导致主库与备库数据不一致。许多nosql也没有支持XA，这让XA的应用场景变得非常狭隘。</p>
<p>·     TCC编程模式</p>
<p>所谓的TCC编程模式，也是两阶段提交的一个变种。TCC提供了一个编程框架，将整个业务逻辑分为三块：Try、Confirm和Cancel三个操作。以在线下单为例，Try阶段会去扣库存，Confirm阶段则是去更新订单状态，如果更新订单失败，则进入Cancel阶段，会去恢复库存。总之，TCC就是通过代码人为实现了两阶段提交，不同的业务场景所写的代码都不一样，复杂度也不一样，因此，这种模式并不能很好地被复用。</p>
<p>分布式事务框架；</p>
<p>买东西：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">wms&#123;</span><br><span class="line">     <span class="comment">//扣库存</span></span><br><span class="line">    koukucun()&#123;</span><br><span class="line">      <span class="comment">//预准备  </span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   tijiaokoukucun()&#123;</span><br><span class="line">      <span class="comment">//update stock set stock=stock-1;  commit;</span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   cancelkoukucun()&#123;</span><br><span class="line">      <span class="comment">//反向扣库存。update stock set stock=stock+1;  commit;</span></span><br><span class="line">     <span class="comment">//undo_log；</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">oms&#123;</span><br><span class="line">    <span class="comment">//创建订单</span></span><br><span class="line">    预准备()&#123;</span><br><span class="line">   &#125;</span><br><span class="line">   保存订单()&#123;</span><br><span class="line">   &#125;</span><br><span class="line">  取消订单()&#123; <span class="comment">//delete&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ums&#123;</span><br><span class="line">   <span class="comment">//扣余额</span></span><br><span class="line">  准备扣()&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  真正扣余额（）&#123;&#125;</span><br><span class="line">  取消扣余额()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     消息事务+最终一致性</p>
<p>基于消息中间件的两阶段提交往往用在高并发场景下，将一个分布式事务拆成一个消息事务（A系统的本地操作+发消息）+B系统的本地操作，其中B系统的操作由消息驱动，只要消息事务成功，那么A操作一定成功，消息也一定发出来了，这时候B会收到消息去执行本地操作，如果本地操作失败，消息会重投，直到B操作成功，这样就变相地实现了A与B的分布式事务。</p>
<p>虽然上面的方案能够完成A和B的操作，但是A和B并不是严格一致的，而是最终一致的，我们在这里牺牲了一致性，换来了性能的大幅度提升。当然，这种玩法也是有风险的，如果B一直执行不成功，那么一致性会被破坏，具体要不要玩，还是得看业务能够承担多少风险。</p>
<p>9.分布式事务解决方案Seata</p>
<p>·     1.核心概念</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Distributed Transaction：分布式事务</span><br><span class="line">Global Transaction：全局事务</span><br><span class="line">Branch Transaction：分支事务</span><br><span class="line">Local Transaction：本地事务</span><br></pre></td></tr></table></figure>

<p>以上四个的关系</p>
<p>官方文档说明：a Distributed Transaction is a Global Transaction which is made up with a batch of Branch Transaction, and normally Branch Transaction is just Local Transaction.</p>
<p>其意思：分布式事务是由一批分支事务组成的全局事务，通常分支事务只是本地事务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Transaction Coordinator(TC)：事务协调器</span><br><span class="line">Transaction Manager(TM)：事务管理器</span><br><span class="line">Resource Manager(RM): 资源管理器</span><br></pre></td></tr></table></figure>

<p>·     2.示例工程的代码: <a target="_blank" rel="noopener" href="https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata">https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata</a></p>
<p>·     3.如何使用Seata</p>
<ul>
<li>1.每一个微服务的数据库，都建立一个seata的undo_log日志表。来记录各个事务的记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `undo_log`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>2.下载并启动seata服务器  <a target="_blank" rel="noopener" href="https://github.com/seata/seata/">https://github.com/seata/seata/</a></p>
</li>
<li><p>3.调整自己的微服务</p>
</li>
<li><p>4.seata其他相关文档</p>
</li>
</ul>
<p>SpringCloud+Seata+Feign案例： <a target="_blank" rel="noopener" href="https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata">https://github.com/seata/seata-samples/tree/master/springcloud-jpa-seata</a></p>
<p>Seata官方文档： <a target="_blank" rel="noopener" href="https://github.com/seata/seata">https://github.com/seata/seata</a></p>
<p>Seata-wiki：<a target="_blank" rel="noopener" href="https://github.com/seata/seata/wiki/Home_Chinese">https://github.com/seata/seata/wiki/Home_Chinese</a></p>
<ul>
<li>5、整合到业务</li>
</ul>
<p>·     1.每一个微服的数据库必须有undo_log表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `undo_log`;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     2.导包</p>
<p>·     seata的starter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·    seata-all</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## transaction log store</span></span><br><span class="line"><span class="string">store</span> &#123;</span><br><span class="line">  <span class="comment">## store mode: file、db</span></span><br><span class="line">  <span class="string">mode</span> <span class="string">=</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">## file store</span></span><br><span class="line">  <span class="string">file</span> &#123;</span><br><span class="line">    <span class="string">dir</span> <span class="string">=</span> <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span></span><br><span class="line">    <span class="string">max-branch-session-size</span> <span class="string">=</span> <span class="number">16384</span></span><br><span class="line">    <span class="comment"># globe session size , if exceeded throws exceptions</span></span><br><span class="line">    <span class="string">max-global-session-size</span> <span class="string">=</span> <span class="number">512</span></span><br><span class="line">    <span class="comment"># file buffer size , if exceeded allocate new buffer</span></span><br><span class="line">    <span class="string">file-write-buffer-cache-size</span> <span class="string">=</span> <span class="number">16384</span></span><br><span class="line">    <span class="comment"># when recover batch read size</span></span><br><span class="line">    <span class="string">session.reload.read_size</span> <span class="string">=</span> <span class="number">100</span></span><br><span class="line">    <span class="comment"># async, sync</span></span><br><span class="line">    <span class="string">flush-disk-mode</span> <span class="string">=</span> <span class="string">async</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">## database store</span></span><br><span class="line">  <span class="string">db</span> &#123;</span><br><span class="line">    <span class="string">driver_class</span> <span class="string">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    <span class="string">url</span> <span class="string">=</span> <span class="string">&quot;jdbc:mysql://192.168.128.130:3306/xx&quot;</span></span><br><span class="line">    <span class="string">user</span> <span class="string">=</span> <span class="string">&quot;root&quot;</span></span><br><span class="line">    <span class="string">password</span> <span class="string">=</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     3.写配置</p>
<p>·     1.我们原来的DataSource要用seata的</p>
<p>·     2.file.conf</p>
<p>·     定义seata客户端核心工作规则信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vgroup_mapping.gulimall-pms-fescar-service-group = &quot;default&quot;</span><br><span class="line"> </span><br><span class="line">vgroup_mapping.前缀.后缀(-fescar-service-group)=&quot;默认名称空间&quot;；</span><br><span class="line"> </span><br><span class="line">$&#123;spring.application.name&#125;-fescar-service-group；必须和但是必须和file.conf中的配置保持一致</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     事务日志</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## transaction log store</span></span><br><span class="line"><span class="string">store</span> &#123;</span><br><span class="line">  <span class="comment">## store mode: file、db</span></span><br><span class="line">  <span class="string">mode</span> <span class="string">=</span> <span class="string">&quot;db&quot;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">## file store</span></span><br><span class="line">  <span class="string">file</span> &#123;</span><br><span class="line">    <span class="string">dir</span> <span class="string">=</span> <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions</span></span><br><span class="line">    <span class="string">max-branch-session-size</span> <span class="string">=</span> <span class="number">16384</span></span><br><span class="line">    <span class="comment"># globe session size , if exceeded throws exceptions</span></span><br><span class="line">    <span class="string">max-global-session-size</span> <span class="string">=</span> <span class="number">512</span></span><br><span class="line">    <span class="comment"># file buffer size , if exceeded allocate new buffer</span></span><br><span class="line">    <span class="string">file-write-buffer-cache-size</span> <span class="string">=</span> <span class="number">16384</span></span><br><span class="line">    <span class="comment"># when recover batch read size</span></span><br><span class="line">    <span class="string">session.reload.read_size</span> <span class="string">=</span> <span class="number">100</span></span><br><span class="line">    <span class="comment"># async, sync</span></span><br><span class="line">    <span class="string">flush-disk-mode</span> <span class="string">=</span> <span class="string">async</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">## database store</span></span><br><span class="line">  <span class="string">db</span> &#123;</span><br><span class="line">    <span class="string">driver_class</span> <span class="string">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    <span class="string">url</span> <span class="string">=</span> <span class="string">&quot;jdbc:mysql://192.168.128.130:3306/xx&quot;</span></span><br><span class="line">    <span class="string">user</span> <span class="string">=</span> <span class="string">&quot;root&quot;</span></span><br><span class="line">    <span class="string">password</span> <span class="string">=</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     当前微服务在seata服务器中注册的信息配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">service &#123;</span><br><span class="line">  #vgroup-&gt;rgroup</span><br><span class="line">  vgroup_mapping.-xxx-fescar-service-group = <span class="attr">&quot;default&quot;</span>  ##当前应用名</span><br><span class="line">  #only support single node</span><br><span class="line">  default.grouplist = <span class="attr">&quot;127.0.0.1:8091&quot;</span>  # seata服务器地址</span><br><span class="line">  #degrade current not support</span><br><span class="line">  enableDegrade = false</span><br><span class="line">  #disable</span><br><span class="line">  disable = false</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     客户端相关工作的机制</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">client &#123;</span><br><span class="line">  async.commit.buffer.limit = 10000</span><br><span class="line">  lock &#123;</span><br><span class="line">    retry.internal = 10</span><br><span class="line">    retry.times = 30</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     3.registry.conf</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file 、nacos 、eureka、redis、zk</span><br><span class="line">  type = <span class="attr">&quot;nacos&quot;</span></span><br><span class="line"> </span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;localhost:8848&quot;</span></span><br><span class="line">    namespace = <span class="attr">&quot;public&quot;</span></span><br><span class="line">    cluster = <span class="attr">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="attr">&quot;http://localhost:1001/eureka&quot;</span></span><br><span class="line">    application = <span class="attr">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="attr">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;localhost:6381&quot;</span></span><br><span class="line">    db = <span class="attr">&quot;0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="attr">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="attr">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.timeout = 6000</span><br><span class="line">    connect.timeout = 2000</span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="attr">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">config &#123;</span><br><span class="line">  # file、nacos 、apollo、zk</span><br><span class="line">  type = <span class="attr">&quot;file&quot;</span></span><br><span class="line"> </span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;localhost&quot;</span></span><br><span class="line">    namespace = <span class="attr">&quot;public&quot;</span></span><br><span class="line">    cluster = <span class="attr">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  apollo &#123;</span><br><span class="line">    app.id = <span class="attr">&quot;fescar-server&quot;</span></span><br><span class="line">    apollo.meta = <span class="attr">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.timeout = 6000</span><br><span class="line">    connect.timeout = 2000</span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="attr">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     定义让seata知道微服务在其他注册中心的一些配置。</p>
<p>·     1、指定注册中心信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file 、nacos 、eureka、redis、zk</span><br><span class="line">  type = <span class="attr">&quot;nacos&quot;</span></span><br><span class="line"> </span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;localhost:8848&quot;</span></span><br><span class="line">    namespace = <span class="attr">&quot;public&quot;</span></span><br><span class="line">    cluster = <span class="attr">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="attr">&quot;http://localhost:1001/eureka&quot;</span></span><br><span class="line">    application = <span class="attr">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="attr">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="attr">&quot;localhost:6381&quot;</span></span><br><span class="line">    db = <span class="attr">&quot;0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="attr">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="attr">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.timeout = 6000</span><br><span class="line">    connect.timeout = 2000</span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="attr">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     2、seata客户端的配置【这些也是可以放在配置中心中】</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">config</span> &#123;</span><br><span class="line">  <span class="comment"># file、nacos 、apollo、zk</span></span><br><span class="line">  <span class="string">type</span> <span class="string">=</span> <span class="string">&quot;file&quot;</span>   <span class="comment">#我们使用的是配置文件。</span></span><br><span class="line"> </span><br><span class="line">  <span class="string">nacos</span> &#123;</span><br><span class="line">    <span class="string">serverAddr</span> <span class="string">=</span> <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    <span class="string">namespace</span> <span class="string">=</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">    <span class="string">cluster</span> <span class="string">=</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">apollo</span> &#123;</span><br><span class="line">    <span class="string">app.id</span> <span class="string">=</span> <span class="string">&quot;fescar-server&quot;</span></span><br><span class="line">    <span class="string">apollo.meta</span> <span class="string">=</span> <span class="string">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">zk</span> &#123;</span><br><span class="line">    <span class="string">serverAddr</span> <span class="string">=</span> <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    <span class="string">session.timeout</span> <span class="string">=</span> <span class="number">6000</span></span><br><span class="line">    <span class="string">connect.timeout</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">file</span> &#123;</span><br><span class="line">    <span class="string">name</span> <span class="string">=</span> <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>·     4.每一个微服务原来自己的数据源都必须使用DataSourceProxy来进行代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">originDataSource</span><span class="params">(<span class="meta">@Value(&quot;$&#123;spring.datasource.jdbcUrl&#125;&quot;)</span> String url, <span class="meta">@Value(&quot;$&#123;spring.datasource.username&#125;&quot;)</span>String Username ,<span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span>String Password,<span class="meta">@Value(&quot;$&#123;spring.datasource.driverClassName&#125;&quot;)</span> String DriverClass)</span></span>&#123;</span><br><span class="line">        HikariDataSource hikariDataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">        hikariDataSource.setJdbcUrl(url);</span><br><span class="line">        hikariDataSource.setUsername(Username);</span><br><span class="line">        hikariDataSource.setPassword(Password);</span><br><span class="line">        hikariDataSource.setDriverClassName(DriverClass);</span><br><span class="line">        <span class="keyword">return</span> hikariDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProxy(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>·     5.若我们使用注册中心，进行服务的发现，seata服务器也得配置放在注册中心，去seata服务器配置registry.conf</p>
<h1 id="11、Spring等高级框架复习"><a href="#11、Spring等高级框架复习" class="headerlink" title="11、Spring等高级框架复习"></a>11、Spring等高级框架复习</h1><h2 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h2><p>1、SpringMVC的图解原理分析</p>
<p>完整的原理图：</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816144434556.png" alt="image-20210816144434556"></p>
<p>2、简单先分析一下上图的流程是怎么样的</p>
<ol>
<li><p>首先发了一个请求过来</p>
</li>
<li><p>那么就要看这个请求能不能发给在web.xml配置的SpringDispatcherServlet，若能够发过来到SpringDispatcherServlet，那么此时这个请求就跟SpringDispatcherServlet的url-pattern相对应。</p>
</li>
<li><p>然后再看SpringMVC里面有没有对应的映射？也即有没有使用@RequestMapping注解映射过，如果要是没有映射过的话，那么就还要来看有没有配置&lt;mvc:default-servlet-handler/&gt;</p>
</li>
<li><p>如果也没有配置&lt;mvc:default-servlet-handler/&gt;的话，控制台就会有一个报错，报错将提示没有对应的映射，同时将会给一个404页面。</p>
</li>
<li><p>如果有配置&lt;mvc:default-servlet-handler/&gt;的话，就会去找目标资源，若目标资源没有的话可能也会给一个404页面，而控制台不会显示：没有对应的映射这样的报错信息。</p>
</li>
<li><p>如果此时要是有对应的@RequestMapping注解映射过，那么这个时候会由HandlerMapping获取一个HandlerExecutionChain对象。</p>
</li>
<li><p>然后再获取一个HandlerAdapter对象。</p>
</li>
<li><p>再调拦截器的PreHandle方法</p>
</li>
<li><p>再调用目标Handler的目标方法得到ModelAndView对象，再调用拦截器的PostHandle方法。</p>
</li>
<li><p>这个时候查看在调用目标方法的过程中是否存在异常，要是有异常的话，将使用异常解析器(HandlerExceptionResolver)去解析这个异常，得到一个新的ModelAndView对象。</p>
</li>
<li><p>然后再由ViewResolver组件根据ModelAndView对象得到实际的View对象</p>
</li>
<li><p>然后去渲染视图。</p>
</li>
<li><p>渲染视图后响应就会得到，然后再调用拦截器的afterCompletion方法。</p>
</li>
</ol>
<p>以上就是整个SpringMVC的运行流程。</p>
<h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="1-SpringBoot自动配置原理"><a href="#1-SpringBoot自动配置原理" class="headerlink" title="1.SpringBoot自动配置原理:"></a>1.SpringBoot自动配置原理:</h3><p>1、当SpringBoot应用启动的时候，就从主方法里面进行启动的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot02ConfigAutoconfigApplication</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot02ConfigAutoconfigApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>它主要加载了@SpringBootApplication注解主配置类，这个@SpringBootApplication注解主配置类里边最主要的功能就是SpringBoot开启了一个@EnableAutoConfiguration注解的自动配置功能。</p>
<p>2、@EnableAutoConfiguration作用：</p>
<p>它主要利用了一个EnableAutoConfigurationImportSelector选择器给Spring容器中来导入一些组件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Import(EnableAutoConfigurationImportSelector.class)</span><br><span class="line">public @interface EnableAutoConfiguration</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、那导入了什么组件呢？</p>
<ol>
<li>来看EnableAutoConfigurationImportSelector这个类的父类selectImports。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">             <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>父类里面规定了一个方法叫selectImports这个方法，查看了selectImports这个方法里面的代码内容就能知道导入了哪些组件了。</p>
</li>
<li><p>在selectImports这个方法里面主要有个configurations，并且这个configurations最终会被返回。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">             <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader</span><br><span class="line">                      .loadMetadata(<span class="keyword">this</span>.beanClassLoader);</span><br><span class="line">             AnnotationAttributes attributes = getAttributes(annotationMetadata);</span><br><span class="line">             List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata,</span><br><span class="line">                      attributes);</span><br><span class="line">             configurations = removeDuplicates(configurations);</span><br><span class="line">             configurations = sort(configurations, autoConfigurationMetadata);</span><br><span class="line">             Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">             checkExcludedClasses(configurations, exclusions);</span><br><span class="line">             configurations.removeAll(exclusions);</span><br><span class="line">             configurations = filter(configurations, autoConfigurationMetadata);</span><br><span class="line">             fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">             <span class="keyword">return</span> configurations.toArray(<span class="keyword">new</span> String[configurations.size()]);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>这个configurations它是获取候选的配置。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata,attributes);</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>这个configurations方法的作用就是利用SpringFactoriesLoader.loadFactoryNames从类路径下得到一个资源。</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">         String factoryClassName = factoryClass.getName();</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</span><br><span class="line">                      ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、那得到了哪些资源呢？</p>
<ol>
<li>它是扫描javajar包类路径下的“META-INF/spring.factories”这个文件。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The location to look for factories.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Can be present in multiple JAR files.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FACTORIES_RESOURCE_LOCATION = <span class="string">&quot;META-INF/spring.factories&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>那么扫描到的这些文件作用：是把这个文件的urls拿到之后并把这些urls每一个遍历，最终把这些文件整成一个properties对象。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">         String factoryClassName = factoryClass.getName();</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Enumeration&lt;URL&gt; urls = (classLoader != <span class="keyword">null</span> ? classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :</span><br><span class="line">                      ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));</span><br><span class="line">             List&lt;String&gt; result = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">             <span class="keyword">while</span> (urls.hasMoreElements()) &#123;</span><br><span class="line">                 URL url = urls.nextElement();</span><br><span class="line">                 Properties properties = PropertiesLoaderUtils.loadProperties(<span class="keyword">new</span> UrlResource(url));</span><br><span class="line">                 String factoryClassNames = properties.getProperty(factoryClassName);</span><br><span class="line">                 result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">return</span> result;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>然后它从properties对象里边获取一些值，把这些获取到的值来加载我们最终要返回的这个结果，这个结果就是我们要交给Spring容器中的所有组件，这相当于这factoryClassName就是我们传过来的Class的这个类名。</p>
</li>
<li><p>而传过来的Class是调用这个getSpringFactoriesLoaderFactoryClass()这个方法得到从properties中获取到EnableAutoConfiguration.class类名对应的值。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; getSpringFactoriesLoaderFactoryClass() &#123;</span><br><span class="line">         <span class="keyword">return</span> EnableAutoConfiguration.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>然后把它们添加在容器中</li>
</ol>
<p>5、按照它的这个意思，来到第二个Springjar包的META-INF下的spring.factories这个文件找到配置所有EnableAutoConfiguration的值加入到Spring容器中</p>
<ol>
<li><p>所以说我们容器中最终会添加很多的类</p>
</li>
<li><p>比如：</p>
</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span></span><br><span class="line"><span class="string">。。。</span></span><br><span class="line"><span class="string">。。。</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>每一个xxxAutoConfiguration类都是容器中的一个组件，并都加入到容器中。</p>
</li>
<li><p>加入到容器中之后的作用就是用它们来做自动配置</p>
</li>
<li><p>这就是Springboot自动配置之源，也就是自动配置的开始</p>
</li>
<li><p>只有这些自动配置类进入到容器中以后，接下来这个自动配置类才开始进行启动</p>
</li>
</ol>
<p>6、每一个自动配置类进行自动配置功能</p>
<ol>
<li><p>以一个自动配置类HttpEncodingAutoConfiguration（HTTP的编码自动配置）为例子来解释SpringBoot的自动配置之原理：</p>
</li>
<li><p>这个HttpEncodingAutoConfiguration类上面标注了一大堆的注解：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//表示这是一个配置类，类似于以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span> <span class="comment">//启用ConfigurationProperties功能：</span></span><br><span class="line"><span class="comment">//这个ConfigurationProperties里面引入了一个类，这个类就是启用指定类的ConfigurationProperties功能</span></span><br><span class="line"><span class="comment">//有了这个@EnableConfigurationPropertie注解以后相当于把配置文件中对应值就和这个HttpEncodingProperties.class类绑定起来了。</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//这个注解的意思就是判断当前是不是web应用，@Conditional是spring底层，意思就是根据不同的条件，来进行自己不同的条件判断，如果满足指定的条件，那么整个配置类里边的配置才会生效。</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span><span class="comment">//看这个类里边有没有这个过滤器，就是判断当前项目里边有没有CharacterEncodingFilter这个类，这个CharacterEncodingFilter类是Springmvc中乱码解决的过滤器。</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span><span class="comment">//@ConditionalOnProperty注解是来判断配置文件中是否存在某个配置，就是是否存在spring.http.encoding.enabled这个配置，matchIfMissing的意思就是如果不存在也认为这个判断是正确的</span></span><br><span class="line"><span class="comment">//即使配置文件中不配置spring.http.encoding.enabled=true这个属性，也是默认生效的</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>点进去HttpEncodingProperties这个类，发现这个HttpEncodingProperties类上面标注了@ConfigurationProperties注解。</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.http.encoding&quot;)</span> <span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingProperties</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>所以说配置文件中该配置什么，我们就按照它的这个旨意，它要配spring.http.encoding这个属性，这个属性里边能配置什么值，就对应HttpEncodingProperties这个类来配置，所有的配置文件中能配置的属性都是在xxx.Properties类中封装着。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.http.encoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingProperties</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Charset of HTTP requests and responses. Added to the &quot;Content-Type&quot; header if not</span></span><br><span class="line"><span class="comment">     * set explicitly.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Charset charset = DEFAULT_CHARSET;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Force the encoding to the configured charset on HTTP requests and responses.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean force;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Force the encoding to the configured charset on HTTP requests. Defaults to true</span></span><br><span class="line"><span class="comment">     * when &quot;force&quot; has not been specified.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean forceRequest;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Force the encoding to the configured charset on HTTP responses.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean forceResponse;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Locale to Encoding mapping.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Locale, Charset&gt; mapping;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Charset <span class="title">getCharset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>.charset;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCharset</span><span class="params">(Charset charset)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.charset = charset;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isForce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Boolean.TRUE.equals(<span class="keyword">this</span>.force);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setForce</span><span class="params">(<span class="keyword">boolean</span> force)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.force = force;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isForceRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Boolean.TRUE.equals(<span class="keyword">this</span>.forceRequest);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setForceRequest</span><span class="params">(<span class="keyword">boolean</span> forceRequest)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.forceRequest = forceRequest;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isForceResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Boolean.TRUE.equals(<span class="keyword">this</span>.forceResponse);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setForceResponse</span><span class="params">(<span class="keyword">boolean</span> forceResponse)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.forceResponse = forceResponse;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Locale, Charset&gt; <span class="title">getMapping</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">this</span>.mapping;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMapping</span><span class="params">(Map&lt;Locale, Charset&gt; mapping)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.mapping = mapping;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>所以说配置文件能配置什么就可以参照某一个功能对应的这个属性类</li>
</ol>
<p>7、这个HttpEncodingProperties类就是根据当前不同的条件判断，决定这个配置类是否生效。</p>
<ol>
<li>如果一旦生效了，所有的配置类都成功了，就给容器中添加各种组件，这些组件的属性是从对应的properties类中获取的，而这properties类里边的每一个属性又是和配置文件绑定的。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span> <span class="comment">//给容器中添加一个组件。</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(CharacterEncodingFilter.class)</span> <span class="comment">//添加一个我们自己来new这个</span></span><br></pre></td></tr></table></figure>

<p>CharacterEncodingFilter，把这个filter添加过去，但是注意这个filter里边要获取字符集的名字（filter.setEncoding(this.properties.getCharset().name());)，你是UTF8编码还是什么编码，它要从properties中进行获取，意思就是这个组件的某些值需要从properties中获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CharacterEncodingFilter <span class="title">characterEncodingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">       filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">       filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">       filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line">       <span class="keyword">return</span> filter;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们再深入的看一下properties。</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties; <span class="comment">//它已经和SpringBoot配置文件进行映射了。</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>我们看到properties是HttpEncodingProperties，也就是说HttpEncodingProperties这个对象的值它是获取配置文件的值的，所以我们在配置这个filter到底要用什么编码的时候是从properties获取的。</p>
</li>
<li><p>而且值得注意的是：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">    <span class="comment">//只有一个有参构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>这个HttpEncodingAutoConfiguration只有一个有参构造器，在只有一个有参构造器的情况下，参数的值就会从容器中拿</li>
</ol>
<p>8、而容器中它怎么去拿到呢？</p>
<ol>
<li><p>相当于是前面的这个@EnableConfigurationProperties(HttpEncodingProperties.class) 注解，这个@EnableConfigurationProperties注解的作用就是把HttpEncodingProperties.class和配置文件进行绑定起来并把HttpEncodingProperties加入到容器中。</p>
</li>
<li><p>接下来这个自动配置类，通过一个有参构造器把这个属性拿到，而这个属性已经和SpringBoot映射了，接下来要用什么编码，就是拿到HttpEncodingProperties这个类里边的属性。</p>
</li>
<li><p>所以SpringBoot能配置什么，它要设置编码，它是获取properties里边getCharset里边的name值。</p>
</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>所以就以此类推，配置一个Spring配置，就可以照着HttpEncodingProperties这里边的来配置。</p>
</li>
<li><p>比如在application.properties配置文件下配置一个http.encoding.enabled属性：</p>
</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.http.encoding.enabled=<span class="keyword">true</span>  <span class="comment">//能配置这个就相当于是我们之前的判断属性</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>还能配置其他的一些属性。比如：</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.http.encoding.charset</span>=<span class="string">UTF-8</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>所以我们能够配置哪些属性，都是来源于这个功能的properties类</p>
</li>
<li><p>有了这个自动配置类，自动配置类就给容器中添加这个filter，然后这个filter就会起作用了。</p>
</li>
<li><p>用好SpringBoot只要把握这几点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）.SpringBoot启动会加载大量的自动配置类</span><br><span class="line">2）.所要做的就是我们需要的功能SpringBoot有没有帮我们写好的自动配置类：</span><br><span class="line">3）.如果有就再来看这个自动配置类中到底配置了哪些组件，Springboot自动配置类里边只要我们要用的组件有，我们就不需要再来配置了，但是如果说没有我们所需要的组件，那么我们就需要自己来写一个配置类来把我们相应的组件配置起来。</span><br><span class="line">4）.给容器中自动配置类添加组件的时候，会从properties类中获取某些属性，而这些属性我们就可以在配置文件指定这些属性的值</span><br></pre></td></tr></table></figure></li>
<li><p>以上内容就是SpringBoot自动配置原理的整个精髓，只要掌握了SpringBoot的原理，我们才能随心所欲的运用。</p>
</li>
</ol>
<h3 id="2-SpringBoot创建及运行原理"><a href="#2-SpringBoot创建及运行原理" class="headerlink" title="2.SpringBoot创建及运行原理:"></a>2.SpringBoot创建及运行原理:</h3><h1 id="12、2020谷粒商城项目复习"><a href="#12、2020谷粒商城项目复习" class="headerlink" title="12、2020谷粒商城项目复习"></a>12、2020谷粒商城项目复习</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><h3 id="分布式Session不共享不同步的问题"><a href="#分布式Session不共享不同步的问题" class="headerlink" title="分布式Session不共享不同步的问题"></a>分布式Session不共享不同步的问题</h3><p>1、你是如何在这个电商系统当中解决Session不共享不同步的问题的？</p>
<p>·     1、如何解决多台同个服务在不同机器上运行的session不同步之问题</p>
<p>第一种解决方案：可以使用session复制来解决Session不同步的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">其优点是：Tomcat原生是支持的，只需要修改一下配置文件即可</span><br><span class="line"></span><br><span class="line">其缺点是：session复制需要数据的传输，可能会有延迟问题，也会占用大量的网络带宽，降级了服务器群的业务处理的能力。在比较大型的分布式集群下，每一个tomcat可能都会全量保存相应的session数据，所以此方案是不可取的。</span><br></pre></td></tr></table></figure>

<p>第二种解决方案：可以让客户端进行存储session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">优点：服务器不需存储session，浏览器自己保存session信息到cookie当中，这样能够节省服务器端的资源</span><br><span class="line"></span><br><span class="line">缺点：每次的HTTP请求，携带用户在cookie中的完整信息，会浪费网络的带宽。而且全部session数据都放在cookie当中，cookie只能限制保存4K，不能保存大量的信息，并且session放在cookie当中也会有不安全的隐患。所以这个方案也不可用</span><br></pre></td></tr></table></figure>

<p>第三种解决方案：可以使用ip的hash一致性，主要是来源于同一个IP访问的，那么就给他永远访问一台服务器就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">优点：只需要改nginx的相应配置，不需要去修改应用的代码，也可以支持web-server的水平扩展，但session同步就不行了，因为受内存的限制</span><br><span class="line"></span><br><span class="line">缺点：session其实还是存在了web-server中，如果web-server重启，也就会导致大量的session丢失。如果web-server进行水平的扩展，hash后session重新分布，也会导致一部分用户路由不到正确的session。</span><br></pre></td></tr></table></figure>

<p>不过以上缺点问题都不是很大，因为session本来都是有效期的</p>
<p>第四种解决方案：统一存储session</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全部session都存到数据库或者是缓存当中</span><br><span class="line"></span><br><span class="line">优点：没有安全的隐患，还可以水平扩展，web-server重启也都不会丢失数据</span><br><span class="line"></span><br><span class="line">缺点：又增加了一次网络的调用，并且可能还需要修改后端的代码</span><br><span class="line"></span><br><span class="line">不过以上统一存储session的缺点，都可以使用SpringSession进行解决</span><br></pre></td></tr></table></figure>

<p>2、如何不同域名的情况下，session不共享的问题</p>
<p>解决方案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">放大session的作用域，不能只是属于某个服务的，将其放大，使其能够在不同子域都能获得这个session</span><br></pre></td></tr></table></figure>

<p>3、使用SpringSession和redis来解决Session的共享问题</p>
<p>4、SpringSession的官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-session/docs/2.2.1.RELEASE/reference/html5/#httpsession-redis-jc">https://docs.spring.io/spring-session/docs/2.2.1.RELEASE/reference/html5/#httpsession-redis-jc</a></p>
<h3 id="电商登录后session共享的整个过程"><a href="#电商登录后session共享的整个过程" class="headerlink" title="电商登录后session共享的整个过程"></a>电商登录后session共享的整个过程</h3><p>1、所有登录后的状态信息是存到session里面的，而任何一个服务都整合了Spring Session，并且将Session统一存储到redis里面</p>
<p>2、让session第一次存储数据的时候，会给浏览器进行发卡，这个卡就标识了session的id是什么，而发的这个卡也放大了整个作用域，让某一个服务发的卡，这个卡可以让全系统服务通用，也即夸整个父子域，不论是父域系统旗下的所有域名，都可以全使用这个session的id，这就是整合Spring Session达到的效果</p>
<p>3、但是在更大的系统里面也会出现一些问题</p>
<p>·     1、一家公司旗下的多个不同网站系统的session共享同步问题，该如何解决？也即在多个系统里面，一旦一个用户已经登录一个网站，那么其他不同系统的网站是否还需要重新登录或者注册？</p>
<p>·     2、在多系统里面，能够希望达到一个效果，只要是一家公司旗下的不同网站系统，在某个网站系统注册和登录过了，就其他网站系统直接能全部自动登录并显示该用户的登录信息，而无需到了其他网站系统还需要重新登录注册。</p>
<p>·     3、解决这问题：可以抽取一个登录注册的认证中心，专门处理不同系统的登录以及注册请求的。一旦用户想要在某个网站系统登录成功了，那么任何其他的网站系统都能使用。但是SpringSession是实现不了这个功能的</p>
<p>·     4、举个例子，在某个电商系统里面登录，如果都用session，那么在发卡的时候，放大了该卡的作用域，也最多放大到该卡的一级域名。但不能放大到更大的域名，比如.com，所以只能放大到一个系统里面服务的域名，那么相当于如果浏览器要访问其他网站，就带不上在电商系统里面发的卡，所以就不能通过简单的SpringSession来解决多系统的单点登录问题</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816145506013.png" alt="image-20210816145506013"></p>
<h3 id="单点登录。怎么实现在不同域名当中其一次登录，处处可用？"><a href="#单点登录。怎么实现在不同域名当中其一次登录，处处可用？" class="headerlink" title="单点登录。怎么实现在不同域名当中其一次登录，处处可用？"></a>单点登录。怎么实现在不同域名当中其一次登录，处处可用？</h3><h5 id="有一个核心服务器"><a href="#有一个核心服务器" class="headerlink" title="有一个核心服务器"></a>有一个核心服务器</h5><p>1.中央认证服务器</p>
<p>所有的登录请求都应该发给中央认证服务器</p>
<p>其他客户端</p>
<p>2.想要登录，都会先去中央认证服务器进行登录，而且登录成功以后跳转回来客户端系统</p>
<p>3.客户端系统只要有一个登录了，那么其他的都不用登录，会自动登录成功</p>
<p>4.在全局任何系统，都统一了一个cookie的唯一标识，这样才能标识哪个用户登录成功的了，这样的话无论是其他系统还是中央认证服务器都不是相同域名旗下的，所以所有系统域名都不相同</p>
<h4 id="怎么解决所有系统域名都不相同，还能达到一处登录，处处自动登录呢？"><a href="#怎么解决所有系统域名都不相同，还能达到一处登录，处处自动登录呢？" class="headerlink" title="怎么解决所有系统域名都不相同，还能达到一处登录，处处自动登录呢？"></a>怎么解决所有系统域名都不相同，还能达到一处登录，处处自动登录呢？</h4><p>单点登录流程</p>
<p>1、浏览器第一次访问到客户端中受保护的请求资源以后</p>
<p>2、客户端就来判断浏览器是否已经登录过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、按照以往常规的流程也即判断session里面有没有这个用户的会话信息，如果有就说明登录了，没有就说明没有登录，没有登录就去登录中心认证服务器登录</span><br><span class="line">2、如果客户端去中心认证服务器登录成功了就要跳转回来，也即从哪跳过来的就从哪跳回去</span><br><span class="line">3、如果当前系统没有保存当前登录的用户，也即客户端没有人登录，如果没有登录就要去访问登陆服务器进行登录</span><br><span class="line">4、由于没登录就给浏览器重定向到登录服务器的登录页面进行登录</span><br><span class="line">5、如果在登录的认证服务器中登录页面登录成功了，就得跳回去</span><br><span class="line">6、那么一旦登录成功以后，怎么跳回去？</span><br><span class="line">	 1、可以跳到登录页的时候，在页面路径后面加一个原来的地址</span><br><span class="line">		这样相当于重定向到登录页的时候，也告诉登录服务器之前原来的地址是哪个地址，这样的话登录服务器，登录成功也就知道跳回哪了</span><br><span class="line">	2、所以为了能登录成功后，能跳回原来的页面，可以在客户端的跳转登录页的控制器请求那加一个重定向原来的地址</span><br><span class="line">	3、这样登录服务器登录成功以后。想要重新跳回客户端以前的页面，就把请求地址那后面的参数地址拿过来就行了，也即客户端得告诉登录服务器，我登录以后想要跳转到哪里</span><br><span class="line">	4、此时登录服务器就能感知到客户端发过来的重定向地址</span><br></pre></td></tr></table></figure>

<p>3、登录认证服务器开始处理登录功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、首先登录服务器展示它的登录页面，而且输入相应的帐号密码登录成功以后还要跳回去</span><br><span class="line">2、为了能跳回去，在方面登录页的时候，登录页是能取到客户端给的登录成功后的URL地址</span><br><span class="line">3、但是我们再来登录，那么上一步的地址就会丢失，所以为了防止这个客户端给的跳转地址丢失，在登录的控制器中将URL地址放到请求域中，可以在登录页面里面可以添加一个隐藏的input输入框，让它自己取出请求域的地址就行了</span><br><span class="line">4、用户在浏览器的登录页面中输入帐号密码进行登录，并且这个登录页也有重定向的地址，也即登录成功以后跳转到客户端给的地址，当登录以后，就会提交登录请求（含用户名，密码，客户端给的登录成功后要重定向跳转的url地址）给登录认证服务器</span><br><span class="line">5、登录认证服务器，就开始处理登录请求</span><br><span class="line">6、登录成功后，就会跳转到客户端在登录请求发来的URL地址</span><br><span class="line">7、登录成功后，无法跳转到客户端指定的URL地址</span><br></pre></td></tr></table></figure>

<ul>
<li>```<br>1、访问客户端指定的URL地址，又要遵循上面的逻辑，也即访问这个客户端的时候，又要看有没有登录，因为客户端总是显示没登录，所以这块就算登录成功后也无法跳转到指定的页面，这就导致了死循环<br>2、如何解决上面这个问题：在认证服务器登录成功以后，重定向跳转回去以后的时候客户端指定地址的时候，客户端要能感知到是已经登录成功以后跳转回来的，而不是直接访问的<br>3、那么能让客户端感知已经登录的业务代码怎么写？<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  1、用redis或者session来存储已经登录的用户信息，在本系统当中我们就用了redis来存储的登录成功的用户信息</span><br><span class="line">  2、那么如果是用session来存储已经登录的用户信息，那么就要发一个卡，类似于银行卡的卡号。</span><br><span class="line">  3、若是在redis存的话key，因为redis会存好多登录的用户，所以要为每一个用户生成一个唯一的key来进行存储，比如可以用UUID来存储key，值就存用户信息</span><br><span class="line">  4、把登录成功后的用户信息存到redis，但是得让其他客户端知道这个用户已经登录过的了</span><br><span class="line">  5、在登录页，登录成功后返回客户端给的重定向URL地址后面再加上一个用户的URL参数（类似于token令牌，token令牌就是UUID）使其能够告诉客户端这个用户已经登录过的了，然后跳转到客户端指定的URL地址</span><br><span class="line">  6、只要登录成功后，带了token令牌，就认为它是已经登录了的。</span><br><span class="line">  7、那么在客户端，只要你登录成功了，返回了客户端指定的URL地址，这URL地址当中还带了token令牌，那么就给你跳转回客户端指定的页面地址</span><br><span class="line">  8、但是token是不一定带的，因为第一次进来访问，就是没有带token的，只有去登录服务器登录回来以后才会有token</span><br><span class="line">  9、登录成功不成功，有两个判断，第一个是先看看session里面有没有用户信息如果有就说明已经登录成功，第二个只要是登录成功后跳回来客户端指定的页面的还带了token的，就说明也是登录成功</span><br><span class="line">  10、有了token，那么登录成功的用户再放到session里面，session的值放的是认证服务器登录后的用户信息，也即在客户端获取认证服务器当前token真正对应的用户信息，拿到了用户信息了，才能说明是成功的。</span><br><span class="line">  11、就成功跳转到客户端指定的URL页面地址</span><br><span class="line">  12、那么在下一次再访问客户端指定的URL页面地址就不用再跳转到认证服务器进行登录了，也是直接能访问到想要访问的资源了</span><br><span class="line">  13、不用登录的原因就是由于在认证服务器登录成功以后跳回去，带了这个token，有了这个token以后，客户端就会去拿到这个token，来证明是登录过的用户</span><br><span class="line">  14、最大的一个问题就是，如果访问其他的客户端域名，会有域名不同的情况，就说明一个客户端登录了，不代表另外一个客户端域名就直接不用登录了</span><br><span class="line">  15、就应该一个客户端登录了，其他客户端就不用再登录了。</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8、一个客户端已经成功登录了，但是怎么能让其他客户端就不用再登录，而直接去访问想要访问的受保护资源？</span><br></pre></td></tr></table></figure>

<ul>
<li><p>```<br>1、由于某一个客户端已经在认证服务器登录过了，那么其他的客户端是互相授信的系统，彼此是信任的，那么就希望第二个客户端系统不用去登录就直接能够访问想要访问的受保护的资源<br>2、访问第二个客户端，默认访问第二个客户端是需要重新登录的，但是第一个客户端已经登录了，就想希望第二个客户端能通过第一个客户端已经登录完成的状态进行免登录<br>3、第二个客户端需要重新登录的原因就是在认证服务器这一块，认证服务器它并没有记住哪些用户已经登录了。<br>4、认证服务器需要保存哪些用户已经登录了的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  1、只要登录成功以后，就会去客户端提供的页面地址重定向过去，还会把当前用户保存过来，也就是重定向的时候带上这个令牌信息</span><br><span class="line">  2、为了下一次别的客户端系统想要登录，得知道上一个客户端系统已经登录过了，就只有一种做法</span><br></pre></td></tr></table></figure>

<ul>
<li><p>```<br>1、客户端访问认证服务器会带上认证服务器的所有的cookie<br>2、假设只要有了登录了，就搞一个cookie，来保存上一个用户登录的用户令牌信息<br>3、所以无论是第一个客户端还是其他多个客户端没有登录，只要能跳到认证服务器的登录页面，浏览器就会带上这个认证服务器下的所有cookie。<br>4、也就是说为了能记住登录的状态信息，即使是上一个人登录，就应该给我们登录服务器留一个痕迹，这个痕迹就是留给客户端浏览器的，告诉客户端浏览器之前这个在认证服务器已经登录过了，痕迹就是cookie<br>5、所以唯一要做的一件事就是处理登录请求和用户状态信息的token返回出去外，还要给当前系统留一个记号，这个记号可以是一个cookie来表示曾经登录过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">   3、单点登录的整个令牌是在登录认证服务器保存的</span><br></pre></td></tr></table></figure></li>
<li><p>```<br>1、登录服务器只要有任何的客户端浏览器登录成功了，那么就给这个客户端浏览器留一个令牌<br>2、登录后的用户信息是在redis当中存起来的，但是为了有标识，认证服务器就命令客户端浏览器保存一个cookie，这个cookie的键是自己定义，值是用户信息的唯一id。<br>3、此时客户端浏览器就应该将认证服务器发过来的cookie保存在认证服务器当中<br>4、只要访问认证服务器，那么认证服务器就会有相应的cookie<br>5、也即某个客户端浏览器没有登录，就会跳转到登录认证服务器进行登录，只要在登录服务器做了登录请求，那么登录服务器关键的一步就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  1、只要进行登录的请求，它会做两件事，把用户信息存到redis里面，并且给当前服务器留一个cookie标识</span><br><span class="line">  2、登录成功就会做两件事</span><br></pre></td></tr></table></figure>

<ul>
<li><p>```<br>1、不止要执行浏览器指定的重定向到地址，并且重定向的时候，还带了token<br>2、登录成功以后，还给当前认证服务器保存了一个用户信息的cookie<br>3、此时又重定向到受保护的资源页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  6、客户端浏览器去认证服务器登录，登录后不仅重定向到浏览器指定的页面，但在重定向之前，客户端浏览器要给认证服务器的域名下保存一个cookie。因为这个登录请求是发给认证服务器的</span><br><span class="line">  7、客户端浏览器在认证服务器登录后，还留了一个cookie的在认证服务器，这个cookie的作用？</span><br></pre></td></tr></table></figure></li>
<li><p>```<br>1、保存cookie的作用就是，客户端浏览器只要以后访问认证服务器的域名，都会带上这个域名下的所有cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  8、目前看到的效果就是：不仅登录成功，跳回客户端浏览器指定的页面地址，还在请求路径上带了一个token，并在域名下面留了一个cookie，cookie和token的值都是一样的</span><br><span class="line">  9、接下来第二个客户端浏览器去访问，显示没有登录，就会重定向跳转到了认证服务器的登录页进行登录</span><br></pre></td></tr></table></figure></li>
<li><p>```<br>1、但是已经有一个客户端浏览器登录过了，登录了以后还给认证服务器留了一个用户的cookie信息<br>2、所以其他客户端浏览器下一次再来访问登录页的时候，就显示没有登录，浏览器就命令去访问登录页。<br>3、但是在访问登录页的时候，这个请求还带上了之前保存的Cookie，这个Cookie就是上一个客户端浏览器登录成功后在认证服务器留下的cookie，所以其他客户端浏览器请求的时候都会带上这个cookie<br>4、登录页的重新处理应该就是：如果客户端浏览器带了这个Cookie，就说明是上一个客户端浏览器留下来的痕迹，那么就可以说明新来的客户端浏览器可以不用登录了<br>5、也即在后台代码的登录页的控制器当中拿到这个Cookie的值<br>6、核心就是：在展示登录页面的时候判断这个客户端浏览器是否已经登录过，判断是否有关键的cookie，如果没有这个cookie，那就展示登录页，如果有就直接免登录，跳回受保护的资源页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  10、为了让客户端浏览器知道，访问认证服务器登录成功以后，那么重定向跳回来的时候就会加一个token，如果有token就认为是登录回来的，就把登录后的信息放到session里面，否则就是直接访问的，那么就要拒绝，并要求它跳回到认证服务器的登录页进行登录</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>```<br>5、此时已经达到了一个客户端浏览器去认证服务器登录后，其他客户端浏览器就已经不用再登录了，直接免登录跳回指定的页面资源地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ```</span><br><span class="line">  1、其他客户端访问资源地址，先判断是否已经登录过，此时客户端浏览器会重定向到认证服务器的登录页面去登录，当然还带着一个cookie。</span><br><span class="line">  2、客户端浏览器就去访问认证服务器的登录页面</span><br><span class="line">  3、其他客户端浏览器访问登录页面的时候，结果登录页面，其他客户端浏览器只要带了这个cookie，因为可能上一次有其他客户端浏览器登录过，那么其他客户端浏览器访问认证服务器就会带上以前浏览器留下的cookie。</span><br><span class="line">  4、如果客户端浏览器带了这个cookie就拿着，直接可以跳回客户端浏览器指定的页面。</span><br><span class="line">  5、那么一旦跳回到客户端浏览器指定的页面</span><br></pre></td></tr></table></figure></li>
</ul>
<p>4、整个单点登录流程图</p>
<p><img src="/2021/08/01/java-2021-08-15-faceQuestions2/image-20210816145535517.png" alt="image-20210816145535517"></p>
<h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><p>1、购物车数据存储在redis中</p>
<p>2、购物车数据存在redis的好处是什么？</p>
<p>·     1、购物车是一个读写都是高并发的操作，那么如果使用Mysql数据库，那么读写都高并发的情况下，就会让mysql数据库都承担非常大的压力</p>
<p>·     2、所以可以选择一些nosql来存储购物车的数据，比如可以使用mongodb，但是使用mongodb的话，它的性能也并不能带来很大的提升</p>
<p>·     3、所以选择了Nosql的redis来存储购物车的数据</p>
<p>·     4、放在redis的好处就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、数据结构好组织</span><br><span class="line">2、redis拥有极高的读写并发性能</span><br></pre></td></tr></table></figure>

<p>·     5、不过存在redis里面也会出现一个问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、也就是登录以后的购物车是需要持久化保存的</span><br><span class="line">2、但是redis默认是内存数据库，所有数据是存在内存的，一旦redis宕机了，那么所有的数据就丢失了</span><br><span class="line">3、但是mysql就不一样了，只要保存了，即使宕机了也还在</span><br><span class="line">4、不过这种问题也可以得到解决</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、在安装redis的时候，可以指定好redis的持久化策略</span><br><span class="line">2、那么在redis的每一条数据，都能持久化到磁盘里面，即使redis宕机，下次重新启动，数据还会在。</span><br><span class="line">3、这样虽然能损失一定的性能，就相当于没有那么高的吞吐量了，但是即使redis的数据存在磁盘里面，也会比mysql快很多。</span><br><span class="line">4、所以用户登录以后，那么在购物车当中的数据存在redis里面</span><br><span class="line">5、如果用户没登录，没有登录的购物车，最大的特点就是一个临时的购物车，其关闭了浏览器，下次打开浏览器还是会有以前保存的临时购物车的数据</span><br><span class="line">6、那么临时购物车，也用redis来存储</span><br><span class="line">7、当然临时购物车也可以存到很多的地方。比如放到cookie当中</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1、但是如果放在cookie当中，那么也就是浏览器存储，后台不存，那么这样的话。在大数据的时代下，想统计一些用户购买了哪些商品，甚至是做一些用户购买的热度高的商品推荐，都是没有办法做到的</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8、最终无论用户登录了的购物车还是没有登录的购物车，都统一存在redis当中</span><br></pre></td></tr></table></figure>

<p>·     6、购物车存在redis的数据应该以什么数据类型来进行存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、一个用户等于两个购物车，一个登录后的购物车，一个是没登录的临时购物车</span><br><span class="line">2、但是不管是哪个购物车，购物车里面数据应该都是有非常多的购物项，也就是添加的那些商品</span><br><span class="line">3、每一个购物项都应该有当期商品的id,因为添加商品都是按照sku销售属性来进行添加的</span><br><span class="line">4、包括每一个购物项是被选中还是没有选中，这个状态也要进行存储</span><br><span class="line">5、保存商品的标题信息和商品的默认图片等信息也要进行存储</span><br><span class="line">6、购物车有很多的购物项，那么使用redis的五种数据类型的哪一种进行一个购物车的存储呢？</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、一个购物车里面就应该是一个数组，数组里面都是一个个的购物项，也就是一个个的对象</span><br><span class="line">2、但是redis里面保存的数据都是以键值对的结构进行存储</span><br><span class="line">3、那么假设用redis的list类型来存储的话，key应该是存用户的标识，代表哪个用户的购物车</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、这个用户的购物车应该是一个数组类型，数组里面放一个个的购物项</span><br><span class="line">2、也即value值存购物车里面的购物项，就是存具体的商品信息</span><br><span class="line">3、如果按照list的数据类型来存储购物车的信息，会有缺点</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、如果来修改某个购物车里面的购物项</span><br><span class="line">2、那么就相当于redis里面存储的购物项也得修改</span><br><span class="line">3、那么就得去redis里面在list数据类型下找这个页面被修改的购物项数据</span><br><span class="line">4、因为是用list来存储购物项，那么问题可能会添加了很多的购物项，在某个购物项修改了相关的信息，那么怎么知道要改购物车里面的哪个商品？</span><br><span class="line">5、可能会有两种办法：</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、得先知道选的是第几个购物项修改的商品信息，在list中来找相应被修改的元素，前提是页面跟后台redis存储的数据顺序是一模一样的，那么就比较容易找到</span><br><span class="line">2、但是会非常的麻烦。所以为了后来的方便快速找购物项的数据并且进行修改</span><br><span class="line">3、可以把购物车里面的list类型存储的购物项改为hash进行存储</span><br><span class="line">4、使用redis的hash进行存储购物车当中的购物项</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、key还是代表某个用户的购物车，这样方便定位到具体的用户的购物车</span><br><span class="line">2、那么hash的value值是有两个值</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、第一个值存储商品的id</span><br><span class="line">2、第二个值存储商品的具体信息</span><br><span class="line">3、那么hash结构的数据类型最终的存储结构应该是这样</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1号用户的购物车里面，存了每一个购物项，数据值是某个商品的id，它的信息是具体的商品信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">4、那么在修改购物项就直接去redis里面找到相应用户的购物车，也不用挨个去遍历来去修改，也可以不用按照其索引来找，因为这样很麻烦，只需要类似于map的方式，按照某个商品的id来修改具体的商品信息。</span><br><span class="line">5、所以在redis里面存购物车的商品不能直接用list方式来存储，因为list来找商品得遍历循环，看是哪个商品</span><br><span class="line">6、但是用于redis的hash结构来存储购物车的商品，也就是map的方式，那么找商品，直接拿key商品的id就能找到</span><br><span class="line">7、最终就应该是以类似于Map 这样的方式来进行存储购物车里面的数据</span><br></pre></td></tr></table></figure>

<p>数据格式：Map&lt;String,Map&lt;String,CartItem&gt;&gt; 有两个key，这个最前面的key是String类型，是存储每一个用户的购物车标识，而Map就是存储整个购物车，这个购物车里面存储每一个的购物项，为了方便找购物项，这个Map的key也是String类型,这个String类型用来存储购物项的商品id，而Map的CartItem对象类型就是存储购物车的详情信息</p>
<p>所以真正的购物车信息应该是以Map&lt;String,Map&lt;String,CartItem&gt;&gt;这样的Hash方式进行存储的</p>
<h4 id="3、离线购物车"><a href="#3、离线购物车" class="headerlink" title="3、离线购物车"></a>3、离线购物车</h4><h4 id="4、在线购物车"><a href="#4、在线购物车" class="headerlink" title="4、在线购物车"></a>4、在线购物车</h4><p>目前整个2020谷粒商城我已经学习和开发完毕，但是我只分享以上三个技术点的笔记，剩下的暂不分享，谢谢理解</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/" title="面试题2" target="_blank" rel="external">http://stary2020.gitee.io/2021/08/01/java-2021-08-15-faceQuestions2/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://stary1999.github.io" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://stary1999.github.io" target="_blank"><span class="text-dark">stary</span><small class="ml-1x">愿启明星照亮信仰，照进现实</small></a></h3>
        <div>成长中的程序员，半个极客，伪文艺青年</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/08/02/java-2021-08-02-faceQuestion/" title="面试题(第一季)"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/07/31/java-2021-07-31-SpringCloud/" title="SpringCloud"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/stary" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2021 stary
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>